"use strict";

const BOX_SIZE = 3;
const SIZE = BOX_SIZE * BOX_SIZE;
const COLUMNS = "012345678";
const ROWS = "ABCDEFGHI";

class Sudoku {
  static getBoardFromHtml() {
    let cells = new Map();
    const rootInput = document.querySelector("#sudokuInput");
    const inputs = rootInput.querySelectorAll("input[type=text]");
    inputs.forEach(input => {
      const x = input.getAttribute("data-x");
      if (cells[x] === undefined) cells[x] = [];
      const y = input.getAttribute("data-y");
      const value = input.value;
      cells.set(y + "" + x, value === "" ? [0] : [parseInt(value)]);
    });
    return cells;
  }

  static displayBoard(cells, id) {
    const rootInput = document.querySelector(id);
    const inputs = rootInput.querySelectorAll("input[type=text]");
    inputs.forEach(input => {
      const x = input.getAttribute("data-x");
      const y = input.getAttribute("data-y");
      input.value = cells.get(y + "" + x)[0] !== 0 ? cells.get(y + "" + x).toString() : "";
      input.disabled = true;
    });
  }

  static resolve() {
    let $resultTitle = document.querySelector(".result-title");
    $resultTitle.classList.remove("not-resolved", "resolved");
    let $loadingBox = document.querySelector(".loader-box");
    let $sudokuTable = document.querySelector("#sudokuSolution");
    $sudokuTable.classList.add("loading");
    $loadingBox.classList.add("is-loading");
    let cells = Sudoku.getBoardFromHtml();
    this.sudokuSolver = new SudokuSolver(cells);
    const [isResolved, resolvedCells] = this.sudokuSolver.process();
    $sudokuTable.classList.remove("loading");
    $loadingBox.classList.remove("is-loading");

    if (!isResolved) {
      $resultTitle.innerHTML = "Non rÃ©solvable.";
      $resultTitle.classList.add("not-resolved");
      return;
    }

    $resultTitle.innerHTML = "RÃ©solu. ðŸ˜Ž";
    $resultTitle.classList.add("resolved");
    Sudoku.displayBoard(resolvedCells, "#sudokuSolution"); // On affiche le sudoku sur la partie droite de l'Ã©cran.
  }

  static generateSudoku(level) {
    let grid;

    if (level === 0) {
      grid = '[["A0",[0]],["A1",[0]],["A2",[0]],["A3",[2]],["A4",[6]],["A5",[0]],["A6",[7]],["A7",[0]],["A8",[1]],["B0",[6]],["B1",[8]],["B2",[0]],["B3",[0]],["B4",[7]],["B5",[0]],["B6",[0]],["B7",[9]],["B8",[0]],["C0",[1]],["C1",[9]],["C2",[0]],["C3",[0]],["C4",[0]],["C5",[4]],["C6",[5]],["C7",[0]],["C8",[0]],["D0",[8]],["D1",[2]],["D2",[0]],["D3",[1]],["D4",[0]],["D5",[0]],["D6",[0]],["D7",[4]],["D8",[0]],["E0",[0]],["E1",[0]],["E2",[4]],["E3",[6]],["E4",[0]],["E5",[2]],["E6",[9]],["E7",[0]],["E8",[0]],["F0",[0]],["F1",[5]],["F2",[0]],["F3",[0]],["F4",[0]],["F5",[3]],["F6",[0]],["F7",[2]],["F8",[8]],["G0",[0]],["G1",[0]],["G2",[9]],["G3",[3]],["G4",[0]],["G5",[0]],["G6",[0]],["G7",[7]],["G8",[4]],["H0",[0]],["H1",[4]],["H2",[0]],["H3",[0]],["H4",[5]],["H5",[0]],["H6",[0]],["H7",[3]],["H8",[6]],["I0",[7]],["I1",[0]],["I2",[3]],["I3",[0]],["I4",[1]],["I5",[8]],["I6",[0]],["I7",[0]],["I8",[0]]]';
    } else if (level === 1) {
      grid = '[["A0",[5]],["A1",[0]],["A2",[1]],["A3",[0]],["A4",[0]],["A5",[0]],["A6",[6]],["A7",[0]],["A8",[4]],["B0",[0]],["B1",[9]],["B2",[0]],["B3",[3]],["B4",[0]],["B5",[6]],["B6",[0]],["B7",[5]],["B8",[0]],["C0",[0]],["C1",[0]],["C2",[0]],["C3",[0]],["C4",[9]],["C5",[0]],["C6",[0]],["C7",[0]],["C8",[0]],["D0",[4]],["D1",[0]],["D2",[0]],["D3",[0]],["D4",[0]],["D5",[0]],["D6",[0]],["D7",[0]],["D8",[9]],["E0",[0]],["E1",[0]],["E2",[0]],["E3",[1]],["E4",[0]],["E5",[9]],["E6",[0]],["E7",[0]],["E8",[0]],["F0",[7]],["F1",[0]],["F2",[0]],["F3",[0]],["F4",[0]],["F5",[0]],["F6",[0]],["F7",[0]],["F8",[6]],["G0",[0]],["G1",[0]],["G2",[0]],["G3",[0]],["G4",[2]],["G5",[0]],["G6",[0]],["G7",[0]],["G8",[0]],["H0",[0]],["H1",[8]],["H2",[0]],["H3",[5]],["H4",[0]],["H5",[7]],["H6",[0]],["H7",[6]],["H8",[0]],["I0",[1]],["I1",[0]],["I2",[3]],["I3",[0]],["I4",[0]],["I5",[0]],["I6",[7]],["I7",[0]],["I8",[2]]]';
    } else if (level === 2) {
      grid = '[["A0",[0]],["A1",[0]],["A2",[0]],["A3",[0]],["A4",[0]],["A5",[0]],["A6",[0]],["A7",[0]],["A8",[0]],["B0",[0]],["B1",[0]],["B2",[0]],["B3",[0]],["B4",[0]],["B5",[3]],["B6",[0]],["B7",[8]],["B8",[5]],["C0",[0]],["C1",[0]],["C2",[1]],["C3",[0]],["C4",[2]],["C5",[0]],["C6",[0]],["C7",[0]],["C8",[0]],["D0",[0]],["D1",[0]],["D2",[0]],["D3",[5]],["D4",[0]],["D5",[7]],["D6",[0]],["D7",[0]],["D8",[0]],["E0",[0]],["E1",[0]],["E2",[4]],["E3",[0]],["E4",[0]],["E5",[0]],["E6",[1]],["E7",[0]],["E8",[0]],["F0",[0]],["F1",[9]],["F2",[0]],["F3",[0]],["F4",[0]],["F5",[0]],["F6",[0]],["F7",[0]],["F8",[0]],["G0",[5]],["G1",[0]],["G2",[0]],["G3",[0]],["G4",[0]],["G5",[0]],["G6",[0]],["G7",[7]],["G8",[3]],["H0",[0]],["H1",[0]],["H2",[2]],["H3",[0]],["H4",[1]],["H5",[0]],["H6",[0]],["H7",[0]],["H8",[0]],["I0",[0]],["I1",[0]],["I2",[0]],["I3",[0]],["I4",[4]],["I5",[0]],["I6",[0]],["I7",[0]],["I8",[9]]]';
    }

    this.displayBoard(new Map(JSON.parse(grid)), "#sudokuInput");
  }

}

class SudokuSolver {
  /** Cell[x][y] */
  constructor(board) {
    this.board = board;
    this.variables = cross(ROWS, COLUMNS);
    this.neighbors = new Map();
    this.possibilities = new Map();
    this.constraints = new Array();
    this.binary_constraints = new Array(); // GENERATION DES POSSIBILITES

    for (const [variable, value] of this.board) {
      this.possibilities.set(variable, value[0] === 0 ? [1, 2, 3, 4, 5, 6, 7, 8, 9] : value);
    } // GENERATION DES CONTRAINTES


    let row_constraints = new Array();
    let box_constraints = new Array();
    let column_constraints = new Array();

    for (let i = 0; i < ROWS.length; i++) {
      column_constraints.push(cross(ROWS[i], COLUMNS));
      row_constraints.push(cross(ROWS, COLUMNS[i]));
    }

    for (const _bi of ["ABC", "DEF", "GHI"]) {
      for (const _bj of ["012", "345", "678"]) {
        box_constraints.push(cross(_bi, _bj));
      }
    } // Transformation en contraintes binaires


    for (const c of column_constraints) {
      this.binary_constraints.push(...permutations(c, 2));
    }

    for (const c of row_constraints) {
      this.binary_constraints.push(...permutations(c, 2));
    }

    for (const c of box_constraints) {
      this.binary_constraints.push(...permutations(c, 2));
    } // GENERATION DES VOISINS


    for (const v of this.variables) {
      this.neighbors.set(v, new Array());

      for (const c of this.binary_constraints) {
        if (v === c[0]) this.neighbors.get(v).push(c[1]);
      }
    }
  } // Insipired by http://aima.cs.berkeley.edu/python/csp.html.


  ac3() {
    let queue = [...this.binary_constraints]; // on clone les contraintes binaires.

    while (queue.length !== 0) {
      const [a, b] = queue.pop();

      if (this.removeInconsistentValues(a, b)) {
        if (this.possibilities.get(a).length === 0) return false;

        for (const n of this.neighbors.get(a)) {
          if (n !== a) {
            queue.push([n, a]);
          }
        }
      }
    }

    return true;
  }
  /**
   * On vÃ©rifie s'il y a des valeurs possibles communes etre a et b, si oui on enlÃ¨ve la possibiltiÃ© dans a.
   * @param a
   * @param b
   * @returns si une valeur Ã  Ã©tÃ© supprimÃ©e.
   */


  removeInconsistentValues(a, b) {
    let removed = false;

    for (const value of this.possibilities.get(a)) {
      let conflict = false;

      for (const poss of this.possibilities.get(b)) {
        if (poss !== value) {
          conflict = true;
          break;
        }
      }

      if (!conflict) {
        const index = this.possibilities.get(a).indexOf(value);
        this.possibilities.get(a).splice(index, 1);
        removed = true;
      }
    }

    return removed;
  } // MRV : On choisit la cellule (variable) avec le moins de possibilitÃ©.


  selectUnassignedVariables(assignement) {
    const unassigned = this.variables.filter(v => [...assignement.keys()].indexOf(v) === -1);
    let min = 10;
    let minV = undefined;

    for (const [variable, poss] of this.possibilities) {
      if (unassigned.indexOf(variable) === -1) continue;

      if (poss.length <= min) {
        min = poss.length;
        minV = variable;
      }
    }

    return minV;
  }

  conflicts(variable, value) {
    let nbConflicts = 0;

    for (let neighbor of this.neighbors.get(variable)) {
      // Si l'intersection des deux possibilitÃ©s n'est pas vide
      if (this.possibilities.get(neighbor).length > 1 && this.possibilities.get(neighbor).indexOf(value) !== -1) {
        nbConflicts++;
      }
    }

    return nbConflicts;
  } // LCV : On choisit une valeur qui Ã  le moins d'impact sur les variables voisines


  orderDomainsValues(variable) {
    let poss = this.possibilities.get(variable);
    return poss.sort((a, b) => {
      return this.conflicts(variable, a) - this.conflicts(variable, b);
    });
  }

  isConsistent(assignement, variable, value) {
    for (const [_variable, _value] of assignement) {
      // si deux variables ont la mÃªme valeur et qu'elles sont voisines alors inconsistent.
      if (_value === value && this.neighbors.get(variable).indexOf(_variable) !== -1) {
        return false;
      }
    }

    return true;
  }

  assign(assignement, variable, value) {
    assignement.set(variable, value);
    this.forwardCheck(assignement, variable, value);
  }

  forwardCheck(assignement, variable, value) {
    for (const neighbor of this.neighbors.get(variable)) {
      if ([...assignement.keys()].indexOf(neighbor) === -1) {
        const index = this.possibilities.get(neighbor).indexOf(value);

        if (index !== -1) {
          this.possibilities.get(neighbor).slice(index, 1);
        }
      }
    }
  }

  remove(assignement, variable) {
    assignement.delete(variable);
  }

  backtracking(assignement) {
    if (assignement.size === this.variables.length) {
      return assignement;
    }

    const variable = this.selectUnassignedVariables(assignement);

    for (const value of this.orderDomainsValues(variable)) {
      if (this.isConsistent(assignement, variable, value)) {
        this.assign(assignement, variable, value);
        const result = this.backtracking(assignement);

        if (result) {
          return result;
        }

        this.remove(assignement, variable);
      }
    }

    return false;
  }

  process() {
    if (this.ac3()) {
      // on vÃ©rifie si le sudoku est complet
      const isFinished = [...this.possibilities.values()].filter(v => v.length !== 1).length === 0;

      if (!isFinished) {
        let assignement = new Map();

        for (const v of this.variables) {
          if (this.possibilities.get(v).length === 1) {
            assignement.set(v, this.possibilities.get(v)[0]);
          }

          assignement = this.backtracking(assignement);

          if (!assignement) {
            this.clearPossibilities(this.possibilities);
            return [false, this.possibilities];
          }

          for (const [variable, value] of assignement) {
            this.possibilities.set(variable, [value]);
          }
        }
      }

      return [true, this.possibilities];
    }

    this.clearPossibilities(this.possibilities);
    return [false, this.possibilities];
  }

  clearPossibilities(possibilites) {
    for (const key of possibilites.keys()) {
      possibilites.set(key, [0]);
    }
  }

} // UTILITY FUNCTIONS
// https://gist.github.com/axelpale/3118596


const kCombinations = (set, k) => {
  if (k > set.length || k <= 0) {
    return [];
  }

  if (k === set.length) {
    return [set];
  }

  if (k === 1) {
    return set.reduce((acc, cur) => [...acc, [cur]], []);
  }

  const combs = [];
  let tail_combs = [];

  for (let i = 0; i <= set.length - k + 1; i++) {
    tail_combs = kCombinations(set.slice(i + 1), k - 1);

    for (let j = 0; j < tail_combs.length; j++) {
      combs.push([set[i], ...tail_combs[j]]);
    }
  }

  return combs;
};

const cross = (A, B) => {
  let res = new Array();

  for (let _a of A) {
    for (let _b of B) {
      res.push(_a + "" + _b);
    }
  }

  return res;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TdWRva3VTb2x2ZXIudHMiXSwibmFtZXMiOlsiQk9YX1NJWkUiLCJTSVpFIiwiQ09MVU1OUyIsIlJPV1MiLCJTdWRva3UiLCJnZXRCb2FyZEZyb21IdG1sIiwiY2VsbHMiLCJNYXAiLCJyb290SW5wdXQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbnB1dHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImlucHV0IiwieCIsImdldEF0dHJpYnV0ZSIsInVuZGVmaW5lZCIsInkiLCJ2YWx1ZSIsInNldCIsInBhcnNlSW50IiwiZGlzcGxheUJvYXJkIiwiaWQiLCJnZXQiLCJ0b1N0cmluZyIsImRpc2FibGVkIiwicmVzb2x2ZSIsIiRyZXN1bHRUaXRsZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsIiRsb2FkaW5nQm94IiwiJHN1ZG9rdVRhYmxlIiwiYWRkIiwic3Vkb2t1U29sdmVyIiwiU3Vkb2t1U29sdmVyIiwiaXNSZXNvbHZlZCIsInJlc29sdmVkQ2VsbHMiLCJwcm9jZXNzIiwiaW5uZXJIVE1MIiwiZ2VuZXJhdGVTdWRva3UiLCJsZXZlbCIsImdyaWQiLCJKU09OIiwicGFyc2UiLCJjb25zdHJ1Y3RvciIsImJvYXJkIiwidmFyaWFibGVzIiwiY3Jvc3MiLCJuZWlnaGJvcnMiLCJwb3NzaWJpbGl0aWVzIiwiY29uc3RyYWludHMiLCJBcnJheSIsImJpbmFyeV9jb25zdHJhaW50cyIsInZhcmlhYmxlIiwicm93X2NvbnN0cmFpbnRzIiwiYm94X2NvbnN0cmFpbnRzIiwiY29sdW1uX2NvbnN0cmFpbnRzIiwiaSIsImxlbmd0aCIsInB1c2giLCJfYmkiLCJfYmoiLCJjIiwicGVybXV0YXRpb25zIiwidiIsImFjMyIsInF1ZXVlIiwiYSIsImIiLCJwb3AiLCJyZW1vdmVJbmNvbnNpc3RlbnRWYWx1ZXMiLCJuIiwicmVtb3ZlZCIsImNvbmZsaWN0IiwicG9zcyIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsInNlbGVjdFVuYXNzaWduZWRWYXJpYWJsZXMiLCJhc3NpZ25lbWVudCIsInVuYXNzaWduZWQiLCJmaWx0ZXIiLCJrZXlzIiwibWluIiwibWluViIsImNvbmZsaWN0cyIsIm5iQ29uZmxpY3RzIiwibmVpZ2hib3IiLCJvcmRlckRvbWFpbnNWYWx1ZXMiLCJzb3J0IiwiaXNDb25zaXN0ZW50IiwiX3ZhcmlhYmxlIiwiX3ZhbHVlIiwiYXNzaWduIiwiZm9yd2FyZENoZWNrIiwic2xpY2UiLCJkZWxldGUiLCJiYWNrdHJhY2tpbmciLCJzaXplIiwicmVzdWx0IiwiaXNGaW5pc2hlZCIsInZhbHVlcyIsImNsZWFyUG9zc2liaWxpdGllcyIsInBvc3NpYmlsaXRlcyIsImtleSIsImtDb21iaW5hdGlvbnMiLCJrIiwicmVkdWNlIiwiYWNjIiwiY3VyIiwiY29tYnMiLCJ0YWlsX2NvbWJzIiwiaiIsIkEiLCJCIiwicmVzIiwiX2EiLCJfYiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxRQUFRLEdBQUcsQ0FBakI7QUFDQSxNQUFNQyxJQUFJLEdBQUdELFFBQVEsR0FBR0EsUUFBeEI7QUFDQSxNQUFNRSxPQUFlLEdBQUcsV0FBeEI7QUFDQSxNQUFNQyxJQUFZLEdBQUcsV0FBckI7O0FBRUEsTUFBTUMsTUFBTixDQUFhO0FBR1gsU0FBZUMsZ0JBQWYsR0FBeUQ7QUFDdkQsUUFBSUMsS0FBNEIsR0FBRyxJQUFJQyxHQUFKLEVBQW5DO0FBQ0EsVUFBTUMsU0FBUyxHQUFHQyxRQUFRLENBQUNDLGFBQVQsQ0FBdUIsY0FBdkIsQ0FBbEI7QUFDQSxVQUFNQyxNQUFNLEdBQUdILFNBQVMsQ0FBQ0ksZ0JBQVYsQ0FBMkIsa0JBQTNCLENBQWY7QUFDQUQsSUFBQUEsTUFBTSxDQUFDRSxPQUFQLENBQWdCQyxLQUFELElBQTZCO0FBQzFDLFlBQU1DLENBQUMsR0FBR0QsS0FBSyxDQUFDRSxZQUFOLENBQW1CLFFBQW5CLENBQVY7QUFDQSxVQUFJVixLQUFLLENBQUNTLENBQUQsQ0FBTCxLQUFhRSxTQUFqQixFQUE0QlgsS0FBSyxDQUFDUyxDQUFE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LENBQWQsQ0FBRCxFQUFtQmlELENBQUMsR0FBRyxDQUF2QixDQUExQjs7QUFDQSxTQUFLLElBQUlNLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdELFVBQVUsQ0FBQ3JELE1BQS9CLEVBQXVDc0QsQ0FBQyxFQUF4QyxFQUE0QztBQUMxQ0YsTUFBQUEsS0FBSyxDQUFDbkQsSUFBTixDQUFXLENBQUN4QyxHQUFHLENBQUNzQyxDQUFELENBQUosRUFBUyxHQUFHc0QsVUFBVSxDQUFDQyxDQUFELENBQXRCLENBQVg7QUFDRDtBQUNGOztBQUVELFNBQU9GLEtBQVA7QUFDRCxDQXhCRDs7QUEwQkEsTUFBTS9ELEtBQUssR0FBRyxDQUFDa0UsQ0FBRCxFQUFZQyxDQUFaLEtBQXlDO0FBQ3JELE1BQUlDLEdBQUcsR0FBRyxJQUFJaEUsS0FBSixFQUFWOztBQUNBLE9BQUssSUFBSWlFLEVBQVQsSUFBZUgsQ0FBZixFQUFrQjtBQUNoQixTQUFLLElBQUlJLEVBQVQsSUFBZUgsQ0FBZixFQUFrQjtBQUNoQkMsTUFBQUEsR0FBRyxDQUFDeEQsSUFBSixDQUFTeUQsRUFBRSxHQUFHLEVBQUwsR0FBVUMsRUFBbkI7QUFDRDtBQUNGOztBQUNELFNBQU9GLEdBQVA7QUFDRCxDQVJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQk9YX1NJWkUgPSAzO1xuY29uc3QgU0laRSA9IEJPWF9TSVpFICogQk9YX1NJWkU7XG5jb25zdCBDT0xVTU5TOiBzdHJpbmcgPSBcIjAxMjM0NTY3OFwiO1xuY29uc3QgUk9XUzogc3RyaW5nID0gXCJBQkNERUZHSElcIjtcblxuY2xhc3MgU3Vkb2t1IHtcbiAgc3RhdGljIHN1ZG9rdVNvbHZlcjogU3Vkb2t1U29sdmVyO1xuXG4gIHByaXZhdGUgc3RhdGljIGdldEJvYXJkRnJvbUh0bWwoKTogTWFwPHN0cmluZywgbnVtYmVyW10+IHtcbiAgICBsZXQgY2VsbHM6IE1hcDxzdHJpbmcsIG51bWJlcltdPiA9IG5ldyBNYXAoKTtcbiAgICBjb25zdCByb290SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3N1ZG9rdUlucHV0XCIpO1xuICAgIGNvbnN0IGlucHV0cyA9IHJvb3RJbnB1dC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXRbdHlwZT10ZXh0XVwiKTtcbiAgICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIGNvbnN0IHggPSBpbnB1dC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIik7XG4gICAgICBpZiAoY2VsbHNbeF0gPT09IHVuZGVmaW5lZCkgY2VsbHNbeF0gPSBbXTtcbiAgICAgIGNvbnN0IHkgPSBpbnB1dC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIik7XG4gICAgICBjb25zdCB2YWx1ZSA9IGlucHV0LnZhbHVlO1xuICAgICAgY2VsbHMuc2V0KHkgKyBcIlwiICsgeCwgdmFsdWUgPT09IFwiXCIgPyBbMF0gOiBbcGFyc2VJbnQodmFsdWUpXSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGNlbGxzO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZGlzcGxheUJvYXJkKGNlbGxzOiBNYXA8c3RyaW5nLCBudW1iZXJbXT4sIGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCByb290SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkKTtcbiAgICBjb25zdCBpbnB1dHMgPSByb290SW5wdXQucXVlcnlTZWxlY3RvckFsbChcImlucHV0W3R5cGU9dGV4dF1cIik7XG4gICAgaW5wdXRzLmZvckVhY2goKGlucHV0OiBIVE1MSW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBjb25zdCB4ID0gaW5wdXQuZ2V0QXR0cmlidXRlKFwiZGF0YS14XCIpO1xuICAgICAgY29uc3QgeSA9IGlucHV0LmdldEF0dHJpYnV0ZShcImRhdGEteVwiKTtcbiAgICAgIGlucHV0LnZhbHVlID1cbiAgICAgICAgY2VsbHMuZ2V0KHkgKyBcIlwiICsgeClbMF0gIT09IDAgPyBjZWxscy5nZXQoeSArIFwiXCIgKyB4KS50b1N0cmluZygpIDogXCJcIjtcbiAgICAgIGlucHV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlKCkge1xuICAgIGxldCAkcmVzdWx0VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdC10aXRsZVwiKTtcbiAgICAkcmVzdWx0VGl0bGUuY2xhc3NMaXN0LnJlbW92ZShcIm5vdC1yZXNvbHZlZFwiLCBcInJlc29sdmVkXCIpO1xuICAgIGxldCAkbG9hZGluZ0JveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubG9hZGVyLWJveFwiKTtcbiAgICBsZXQgJHN1ZG9rdVRhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzdWRva3VTb2x1dGlvblwiKTtcbiAgICAkc3Vkb2t1VGFibGUuY2xhc3NMaXN0LmFkZChcImxvYWRpbmdcIik7XG4gICAgJGxvYWRpbmdCb3guY2xhc3NMaXN0LmFkZChcImlzLWxvYWRpbmdcIik7XG4gICAgbGV0IGNlbGxzID0gU3Vkb2t1LmdldEJvYXJkRnJvbUh0bWwoKTtcblxuICAgIHRoaXMuc3Vkb2t1U29sdmVyID0gbmV3IFN1ZG9rdVNvbHZlcihjZWxscyk7XG4gICAgY29uc3QgW2lzUmVzb2x2ZWQsIHJlc29sdmVkQ2VsbHNdID0gdGhpcy5zdWRva3VTb2x2ZXIucHJvY2VzcygpO1xuICAgICRzdWRva3VUYWJsZS5jbGFzc0xpc3QucmVtb3ZlKFwibG9hZGluZ1wiKTtcbiAgICAkbG9hZGluZ0JveC5jbGFzc0xpc3QucmVtb3ZlKFwiaXMtbG9hZGluZ1wiKTtcbiAgICBpZiAoIWlzUmVzb2x2ZWQpIHtcbiAgICAgICRyZXN1bHRUaXRsZS5pbm5lckhUTUwgPSBcIk5vbiByw6lzb2x2YWJsZS5cIjtcbiAgICAgICRyZXN1bHRUaXRsZS5jbGFzc0xpc3QuYWRkKFwibm90LXJlc29sdmVkXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAkcmVzdWx0VGl0bGUuaW5uZXJIVE1MID0gXCJSw6lzb2x1LiDwn5iOXCI7XG4gICAgJHJlc3VsdFRpdGxlLmNsYXNzTGlzdC5hZGQoXCJyZXNvbHZlZFwiKTtcbiAgICBTdWRva3UuZGlzcGxheUJvYXJkKHJlc29sdmVkQ2VsbHMsIFwiI3N1ZG9rdVNvbHV0aW9uXCIpO1xuICAgIC8vIE9uIGFmZmljaGUgbGUgc3Vkb2t1IHN1ciBsYSBwYXJ0aWUgZHJvaXRlIGRlIGwnw6ljcmFuLlxuICB9XG5cbiAgc3RhdGljIGdlbmVyYXRlU3Vkb2t1KGxldmVsOiBudW1iZXIpIHtcbiAgICBsZXQgZ3JpZDogc3RyaW5nO1xuICAgIGlmIChsZXZlbCA9PT0gMCkge1xuICAgICAgZ3JpZCA9XG4gICAgICAgICdbW1wiQTBcIixbMF1dLFtcIkExXCIsWzBdXSxbXCJBMlwiLFswXV0sW1wiQTNcIixbMl1dLFtcIkE0XCIsWzZdXSxbXCJBNVwiLFswXV0sW1wiQTZcIixbN11dLFtcIkE3XCIsWzBdXSxbXCJBOFwiLFsxXV0sW1wiQjBcIixbNl1dLFtcIkIxXCIsWzhdXSxbXCJCMlwiLFswXV0sW1wiQjNcIixbMF1dLFtcIkI0XCIsWzddXSxbXCJCNVwiLFswXV0sW1wiQjZcIixbMF1dLFtcIkI3XCIsWzldXSxbXCJCOFwiLFswXV0sW1wiQzBcIixbMV1dLFtcIkMxXCIsWzldXSxbXCJDMlwiLFswXV0sW1wiQzNcIixbMF1dLFtcIkM0XCIsWzBdXSxbXCJDNVwiLFs0XV0sW1wiQzZcIixbNV1dLFtcIkM3XCIsWzBdXSxbXCJDOFwiLFswXV0sW1wiRDBcIixbOF1dLFtcIkQxXCIsWzJdXSxbXCJEMlwiLFswXV0sW1wiRDNcIixbMV1dLFtcIkQ0XCIsWzBdXSxbXCJENVwiLFswXV0sW1wiRDZcIixbMF1dLFtcIkQ3XCIsWzRdXSxbXCJEOFwiLFswXV0sW1wiRTBcIixbMF1dLFtcIkUxXCIsWzBdXSxbXCJFMlwiLFs0XV0sW1wiRTNcIixbNl1dLFtcIkU0XCIsWzBdXSxbXCJFNVwiLFsyXV0sW1wiRTZcIixbOV1dLFtcIkU3XCIsWzBdXSxbXCJFOFwiLFswXV0sW1wiRjBcIixbMF1dLFtcIkYxXCIsWzVdXSxbXCJGMlwiLFswXV0sW1wiRjNcIixbMF1dLFtcIkY0XCIsWzBdXSxbXCJGNVwiLFszXV0sW1wiRjZcIixbMF1dLFtcIkY3XCIsWzJdXSxbXCJGOFwiLFs4XV0sW1wiRzBcIixbMF1dLFtcIkcxXCIsWzBdXSxbXCJHMlwiLFs5XV0sW1wiRzNcIixbM11dLFtcIkc0XCIsWzBdXSxbXCJHNVwiLFswXV0sW1wiRzZcIixbMF1dLFtcIkc3XCIsWzddXSxbXCJHOFwiLFs0XV0sW1wiSDBcIixbMF1dLFtcIkgxXCIsWzRdXSxbXCJIMlwiLFswXV0sW1wiSDNcIixbMF1dLFtcIkg0XCIsWzVdXSxbXCJINVwiLFswXV0sW1wiSDZcIixbMF1dLFtcIkg3XCIsWzNdXSxbXCJIOFwiLFs2XV0sW1wiSTBcIixbN11dLFtcIkkxXCIsWzBdXSxbXCJJMlwiLFszXV0sW1wiSTNcIixbMF1dLFtcIkk0XCIsWzFdXSxbXCJJNVwiLFs4XV0sW1wiSTZcIixbMF1dLFtcIkk3XCIsWzBdXSxbXCJJOFwiLFswXV1dJztcbiAgICB9IGVsc2UgaWYgKGxldmVsID09PSAxKSB7XG4gICAgICBncmlkID1cbiAgICAgICAgJ1tbXCJBMFwiLFs1XV0sW1wiQTFcIixbMF1dLFtcIkEyXCIsWzFdXSxbXCJBM1wiLFswXV0sW1wiQTRcIixbMF1dLFtcIkE1XCIsWzBdXSxbXCJBNlwiLFs2XV0sW1wiQTdcIixbMF1dLFtcIkE4XCIsWzRdXSxbXCJCMFwiLFswXV0sW1wiQjFcIixbOV1dLFtcIkIyXCIsWzBdXSxbXCJCM1wiLFszXV0sW1wiQjRcIixbMF1dLFtcIkI1XCIsWzZdXSxbXCJCNlwiLFswXV0sW1wiQjdcIixbNV1dLFtcIkI4XCIsWzBdXSxbXCJDMFwiLFswXV0sW1wiQzFcIixbMF1dLFtcIkMyXCIsWzBdXSxbXCJDM1wiLFswXV0sW1wiQzRcIixbOV1dLFtcIkM1XCIsWzBdXSxbXCJDNlwiLFswXV0sW1wiQzdcIixbMF1dLFtcIkM4XCIsWzBdXSxbXCJEMFwiLFs0XV0sW1wiRDFcIixbMF1dLFtcIkQyXCIsWzBdXSxbXCJEM1wiLFswXV0sW1wiRDRcIixbMF1dLFtcIkQ1XCIsWzBdXSxbXCJENlwiLFswXV0sW1wiRDdcIixbMF1dLFtcIkQ4XCIsWzldXSxbXCJFMFwiLFswXV0sW1wiRTFcIixbMF1dLFtcIkUyXCIsWzBdXSxbXCJFM1wiLFsxXV0sW1wiRTRcIixbMF1dLFtcIkU1XCIsWzldXSxbXCJFNlwiLFswXV0sW1wiRTdcIixbMF1dLFtcIkU4XCIsWzBdXSxbXCJGMFwiLFs3XV0sW1wiRjFcIixbMF1dLFtcIkYyXCIsWzBdXSxbXCJGM1wiLFswXV0sW1wiRjRcIixbMF1dLFtcIkY1XCIsWzBdXSxbXCJGNlwiLFswXV0sW1wiRjdcIixbMF1dLFtcIkY4XCIsWzZdXSxbXCJHMFwiLFswXV0sW1wiRzFcIixbMF1dLFtcIkcyXCIsWzBdXSxbXCJHM1wiLFswXV0sW1wiRzRcIixbMl1dLFtcIkc1XCIsWzBdXSxbXCJHNlwiLFswXV0sW1wiRzdcIixbMF1dLFtcIkc4XCIsWzBdXSxbXCJIMFwiLFswXV0sW1wiSDFcIixbOF1dLFtcIkgyXCIsWzBdXSxbXCJIM1wiLFs1XV0sW1wiSDRcIixbMF1dLFtcIkg1XCIsWzddXSxbXCJINlwiLFswXV0sW1wiSDdcIixbNl1dLFtcIkg4XCIsWzBdXSxbXCJJMFwiLFsxXV0sW1wiSTFcIixbMF1dLFtcIkkyXCIsWzNdXSxbXCJJM1wiLFswXV0sW1wiSTRcIixbMF1dLFtcIkk1XCIsWzBdXSxbXCJJNlwiLFs3XV0sW1wiSTdcIixbMF1dLFtcIkk4XCIsWzJdXV0nO1xuICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09IDIpIHtcbiAgICAgIGdyaWQgPVxuICAgICAgICAnW1tcIkEwXCIsWzBdXSxbXCJBMVwiLFswXV0sW1wiQTJcIixbMF1dLFtcIkEzXCIsWzBdXSxbXCJBNFwiLFswXV0sW1wiQTVcIixbMF1dLFtcIkE2XCIsWzBdXSxbXCJBN1wiLFswXV0sW1wiQThcIixbMF1dLFtcIkIwXCIsWzBdXSxbXCJCMVwiLFswXV0sW1wiQjJcIixbMF1dLFtcIkIzXCIsWzBdXSxbXCJCNFwiLFswXV0sW1wiQjVcIixbM11dLFtcIkI2XCIsWzBdXSxbXCJCN1wiLFs4XV0sW1wiQjhcIixbNV1dLFtcIkMwXCIsWzBdXSxbXCJDMVwiLFswXV0sW1wiQzJcIixbMV1dLFtcIkMzXCIsWzBdXSxbXCJDNFwiLFsyXV0sW1wiQzVcIixbMF1dLFtcIkM2XCIsWzBdXSxbXCJDN1wiLFswXV0sW1wiQzhcIixbMF1dLFtcIkQwXCIsWzBdXSxbXCJEMVwiLFswXV0sW1wiRDJcIixbMF1dLFtcIkQzXCIsWzVdXSxbXCJENFwiLFswXV0sW1wiRDVcIixbN11dLFtcIkQ2XCIsWzBdXSxbXCJEN1wiLFswXV0sW1wiRDhcIixbMF1dLFtcIkUwXCIsWzBdXSxbXCJFMVwiLFswXV0sW1wiRTJcIixbNF1dLFtcIkUzXCIsWzBdXSxbXCJFNFwiLFswXV0sW1wiRTVcIixbMF1dLFtcIkU2XCIsWzFdXSxbXCJFN1wiLFswXV0sW1wiRThcIixbMF1dLFtcIkYwXCIsWzBdXSxbXCJGMVwiLFs5XV0sW1wiRjJcIixbMF1dLFtcIkYzXCIsWzBdXSxbXCJGNFwiLFswXV0sW1wiRjVcIixbMF1dLFtcIkY2XCIsWzBdXSxbXCJGN1wiLFswXV0sW1wiRjhcIixbMF1dLFtcIkcwXCIsWzVdXSxbXCJHMVwiLFswXV0sW1wiRzJcIixbMF1dLFtcIkczXCIsWzBdXSxbXCJHNFwiLFswXV0sW1wiRzVcIixbMF1dLFtcIkc2XCIsWzBdXSxbXCJHN1wiLFs3XV0sW1wiRzhcIixbM11dLFtcIkgwXCIsWzBdXSxbXCJIMVwiLFswXV0sW1wiSDJcIixbMl1dLFtcIkgzXCIsWzBdXSxbXCJINFwiLFsxXV0sW1wiSDVcIixbMF1dLFtcIkg2XCIsWzBdXSxbXCJIN1wiLFswXV0sW1wiSDhcIixbMF1dLFtcIkkwXCIsWzBdXSxbXCJJMVwiLFswXV0sW1wiSTJcIixbMF1dLFtcIkkzXCIsWzBdXSxbXCJJNFwiLFs0XV0sW1wiSTVcIixbMF1dLFtcIkk2XCIsWzBdXSxbXCJJN1wiLFswXV0sW1wiSThcIixbOV1dXSc7XG4gICAgfVxuICAgIHRoaXMuZGlzcGxheUJvYXJkKG5ldyBNYXAoSlNPTi5wYXJzZShncmlkKSksIFwiI3N1ZG9rdUlucHV0XCIpO1xuICB9XG59XG5cbmNsYXNzIFN1ZG9rdVNvbHZlciB7XG4gIC8qKiBDZWxsW3hdW3ldICovXG4gIGJvYXJkOiBNYXA8c3RyaW5nLCBudW1iZXJbXT47XG4gIHZhcmlhYmxlczogQXJyYXk8c3RyaW5nPjtcbiAgY29uc3RyYWludHM6IEFycmF5PEFycmF5PHN0cmluZz4+O1xuICBiaW5hcnlfY29uc3RyYWludHM6IEFycmF5PEFycmF5PHN0cmluZz4+O1xuICBuZWlnaGJvcnM6IE1hcDxzdHJpbmcsIEFycmF5PHN0cmluZz4+O1xuICBwb3NzaWJpbGl0aWVzOiBNYXA8c3RyaW5nLCBBcnJheTxudW1iZXI+PjtcblxuICBjb25zdHJ1Y3Rvcihib2FyZDogTWFwPHN0cmluZywgbnVtYmVyW10+KSB7XG4gICAgdGhpcy5ib2FyZCA9IGJvYXJkO1xuICAgIHRoaXMudmFyaWFibGVzID0gY3Jvc3MoUk9XUywgQ09MVU1OUyk7XG4gICAgdGhpcy5uZWlnaGJvcnMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5wb3NzaWJpbGl0aWVzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuY29uc3RyYWludHMgPSBuZXcgQXJyYXkoKTtcbiAgICB0aGlzLmJpbmFyeV9jb25zdHJhaW50cyA9IG5ldyBBcnJheSgpO1xuXG4gICAgLy8gR0VORVJBVElPTiBERVMgUE9TU0lCSUxJVEVTXG5cbiAgICBmb3IgKGNvbnN0IFt2YXJpYWJsZSwgdmFsdWVdIG9mIHRoaXMuYm9hcmQpIHtcbiAgICAgIHRoaXMucG9zc2liaWxpdGllcy5zZXQoXG4gICAgICAgIHZhcmlhYmxlLFxuICAgICAgICB2YWx1ZVswXSA9PT0gMCA/IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5XSA6IHZhbHVlXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEdFTkVSQVRJT04gREVTIENPTlRSQUlOVEVTXG5cbiAgICBsZXQgcm93X2NvbnN0cmFpbnRzID0gbmV3IEFycmF5PEFycmF5PHN0cmluZz4+KCk7XG4gICAgbGV0IGJveF9jb25zdHJhaW50cyA9IG5ldyBBcnJheTxBcnJheTxzdHJpbmc+PigpO1xuICAgIGxldCBjb2x1bW5fY29uc3RyYWludHMgPSBuZXcgQXJyYXk8QXJyYXk8c3RyaW5nPj4oKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgUk9XUy5sZW5ndGg7IGkrKykge1xuICAgICAgY29sdW1uX2NvbnN0cmFpbnRzLnB1c2goY3Jvc3MoUk9XU1tpXSwgQ09MVU1OUykpO1xuICAgICAgcm93X2NvbnN0cmFpbnRzLnB1c2goY3Jvc3MoUk9XUywgQ09MVU1OU1tpXSkpO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgX2JpIG9mIFtcIkFCQ1wiLCBcIkRFRlwiLCBcIkdISVwiXSkge1xuICAgICAgZm9yIChjb25zdCBfYmogb2YgW1wiMDEyXCIsIFwiMzQ1XCIsIFwiNjc4XCJdKSB7XG4gICAgICAgIGJveF9jb25zdHJhaW50cy5wdXNoKGNyb3NzKF9iaSwgX2JqKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVHJhbnNmb3JtYXRpb24gZW4gY29udHJhaW50ZXMgYmluYWlyZXNcblxuICAgIGZvciAoY29uc3QgYyBvZiBjb2x1bW5fY29uc3RyYWludHMpIHtcbiAgICAgIHRoaXMuYmluYXJ5X2NvbnN0cmFpbnRzLnB1c2goLi4ucGVybXV0YXRpb25zKGMsIDIpKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBjIG9mIHJvd19jb25zdHJhaW50cykge1xuICAgICAgdGhpcy5iaW5hcnlfY29uc3RyYWludHMucHVzaCguLi5wZXJtdXRhdGlvbnMoYywgMikpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGMgb2YgYm94X2NvbnN0cmFpbnRzKSB7XG4gICAgICB0aGlzLmJpbmFyeV9jb25zdHJhaW50cy5wdXNoKC4uLnBlcm11dGF0aW9ucyhjLCAyKSk7XG4gICAgfVxuXG4gICAgLy8gR0VORVJBVElPTiBERVMgVk9JU0lOU1xuXG4gICAgZm9yIChjb25zdCB2IG9mIHRoaXMudmFyaWFibGVzKSB7XG4gICAgICB0aGlzLm5laWdoYm9ycy5zZXQodiwgbmV3IEFycmF5PHN0cmluZz4oKSk7XG4gICAgICBmb3IgKGNvbnN0IGMgb2YgdGhpcy5iaW5hcnlfY29uc3RyYWludHMpIHtcbiAgICAgICAgaWYgKHYgPT09IGNbMF0pIHRoaXMubmVpZ2hib3JzLmdldCh2KS5wdXNoKGNbMV0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIEluc2lwaXJlZCBieSBodHRwOi8vYWltYS5jcy5iZXJrZWxleS5lZHUvcHl0aG9uL2NzcC5odG1sLlxuICBwdWJsaWMgYWMzKCk6IGJvb2xlYW4ge1xuICAgIGxldCBxdWV1ZSA9IFsuLi50aGlzLmJpbmFyeV9jb25zdHJhaW50c107IC8vIG9uIGNsb25lIGxlcyBjb250cmFpbnRlcyBiaW5haXJlcy5cblxuICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggIT09IDApIHtcbiAgICAgIGNvbnN0IFthLCBiXSA9IHF1ZXVlLnBvcCgpO1xuXG4gICAgICBpZiAodGhpcy5yZW1vdmVJbmNvbnNpc3RlbnRWYWx1ZXMoYSwgYikpIHtcbiAgICAgICAgaWYgKHRoaXMucG9zc2liaWxpdGllcy5nZXQoYSkubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgZm9yIChjb25zdCBuIG9mIHRoaXMubmVpZ2hib3JzLmdldChhKSkge1xuICAgICAgICAgIGlmIChuICE9PSBhKSB7XG4gICAgICAgICAgICBxdWV1ZS5wdXNoKFtuLCBhXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIE9uIHbDqXJpZmllIHMnaWwgeSBhIGRlcyB2YWxldXJzIHBvc3NpYmxlcyBjb21tdW5lcyBldHJlIGEgZXQgYiwgc2kgb3VpIG9uIGVubMOodmUgbGEgcG9zc2liaWx0acOpIGRhbnMgYS5cbiAgICogQHBhcmFtIGFcbiAgICogQHBhcmFtIGJcbiAgICogQHJldHVybnMgc2kgdW5lIHZhbGV1ciDDoCDDqXTDqSBzdXBwcmltw6llLlxuICAgKi9cbiAgcHJpdmF0ZSByZW1vdmVJbmNvbnNpc3RlbnRWYWx1ZXMoYTogc3RyaW5nLCBiOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBsZXQgcmVtb3ZlZCA9IGZhbHNlO1xuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgdGhpcy5wb3NzaWJpbGl0aWVzLmdldChhKSkge1xuICAgICAgbGV0IGNvbmZsaWN0ID0gZmFsc2U7XG4gICAgICBmb3IgKGNvbnN0IHBvc3Mgb2YgdGhpcy5wb3NzaWJpbGl0aWVzLmdldChiKSkge1xuICAgICAgICBpZiAocG9zcyAhPT0gdmFsdWUpIHtcbiAgICAgICAgICBjb25mbGljdCA9IHRydWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghY29uZmxpY3QpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KGEpLmluZGV4T2YodmFsdWUpO1xuICAgICAgICB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KGEpLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHJlbW92ZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVtb3ZlZDtcbiAgfVxuXG4gIC8vIE1SViA6IE9uIGNob2lzaXQgbGEgY2VsbHVsZSAodmFyaWFibGUpIGF2ZWMgbGUgbW9pbnMgZGUgcG9zc2liaWxpdMOpLlxuICBwcml2YXRlIHNlbGVjdFVuYXNzaWduZWRWYXJpYWJsZXMoYXNzaWduZW1lbnQ6IE1hcDxzdHJpbmcsIG51bWJlcj4pOiBzdHJpbmcge1xuICAgIGNvbnN0IHVuYXNzaWduZWQgPSB0aGlzLnZhcmlhYmxlcy5maWx0ZXIoXG4gICAgICB2ID0+IFsuLi5hc3NpZ25lbWVudC5rZXlzKCldLmluZGV4T2YodikgPT09IC0xXG4gICAgKTtcbiAgICBsZXQgbWluID0gMTA7XG4gICAgbGV0IG1pblYgPSB1bmRlZmluZWQ7XG4gICAgZm9yIChjb25zdCBbdmFyaWFibGUsIHBvc3NdIG9mIHRoaXMucG9zc2liaWxpdGllcykge1xuICAgICAgaWYgKHVuYXNzaWduZWQuaW5kZXhPZih2YXJpYWJsZSkgPT09IC0xKSBjb250aW51ZTtcbiAgICAgIGlmIChwb3NzLmxlbmd0aCA8PSBtaW4pIHtcbiAgICAgICAgbWluID0gcG9zcy5sZW5ndGg7XG4gICAgICAgIG1pblYgPSB2YXJpYWJsZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1pblY7XG4gIH1cblxuICBwcml2YXRlIGNvbmZsaWN0cyh2YXJpYWJsZTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBsZXQgbmJDb25mbGljdHMgPSAwO1xuICAgIGZvciAobGV0IG5laWdoYm9yIG9mIHRoaXMubmVpZ2hib3JzLmdldCh2YXJpYWJsZSkpIHtcbiAgICAgIC8vIFNpIGwnaW50ZXJzZWN0aW9uIGRlcyBkZXV4IHBvc3NpYmlsaXTDqXMgbidlc3QgcGFzIHZpZGVcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5wb3NzaWJpbGl0aWVzLmdldChuZWlnaGJvcikubGVuZ3RoID4gMSAmJlxuICAgICAgICB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KG5laWdoYm9yKS5pbmRleE9mKHZhbHVlKSAhPT0gLTFcbiAgICAgICkge1xuICAgICAgICBuYkNvbmZsaWN0cysrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmJDb25mbGljdHM7XG4gIH1cblxuICAvLyBMQ1YgOiBPbiBjaG9pc2l0IHVuZSB2YWxldXIgcXVpIMOgIGxlIG1vaW5zIGQnaW1wYWN0IHN1ciBsZXMgdmFyaWFibGVzIHZvaXNpbmVzXG4gIHByaXZhdGUgb3JkZXJEb21haW5zVmFsdWVzKHZhcmlhYmxlOiBzdHJpbmcpOiBudW1iZXJbXSB7XG4gICAgbGV0IHBvc3MgPSB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KHZhcmlhYmxlKTtcbiAgICByZXR1cm4gcG9zcy5zb3J0KChhOiBudW1iZXIsIGI6IG51bWJlcik6IG51bWJlciA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5jb25mbGljdHModmFyaWFibGUsIGEpIC0gdGhpcy5jb25mbGljdHModmFyaWFibGUsIGIpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0NvbnNpc3RlbnQoXG4gICAgYXNzaWduZW1lbnQ6IE1hcDxzdHJpbmcsIG51bWJlcj4sXG4gICAgdmFyaWFibGU6IHN0cmluZyxcbiAgICB2YWx1ZTogbnVtYmVyXG4gICk6IGJvb2xlYW4ge1xuICAgIGZvciAoY29uc3QgW192YXJpYWJsZSwgX3ZhbHVlXSBvZiBhc3NpZ25lbWVudCkge1xuICAgICAgLy8gc2kgZGV1eCB2YXJpYWJsZXMgb250IGxhIG3Dqm1lIHZhbGV1ciBldCBxdSdlbGxlcyBzb250IHZvaXNpbmVzIGFsb3JzIGluY29uc2lzdGVudC5cbiAgICAgIGlmIChcbiAgICAgICAgX3ZhbHVlID09PSB2YWx1ZSAmJlxuICAgICAgICB0aGlzLm5laWdoYm9ycy5nZXQodmFyaWFibGUpLmluZGV4T2YoX3ZhcmlhYmxlKSAhPT0gLTFcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3NpZ24oXG4gICAgYXNzaWduZW1lbnQ6IE1hcDxzdHJpbmcsIG51bWJlcj4sXG4gICAgdmFyaWFibGU6IHN0cmluZyxcbiAgICB2YWx1ZTogbnVtYmVyXG4gICkge1xuICAgIGFzc2lnbmVtZW50LnNldCh2YXJpYWJsZSwgdmFsdWUpO1xuXG4gICAgdGhpcy5mb3J3YXJkQ2hlY2soYXNzaWduZW1lbnQsIHZhcmlhYmxlLCB2YWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIGZvcndhcmRDaGVjayhcbiAgICBhc3NpZ25lbWVudDogTWFwPHN0cmluZywgbnVtYmVyPixcbiAgICB2YXJpYWJsZTogc3RyaW5nLFxuICAgIHZhbHVlOiBudW1iZXJcbiAgKSB7XG4gICAgZm9yIChjb25zdCBuZWlnaGJvciBvZiB0aGlzLm5laWdoYm9ycy5nZXQodmFyaWFibGUpKSB7XG4gICAgICBpZiAoWy4uLmFzc2lnbmVtZW50LmtleXMoKV0uaW5kZXhPZihuZWlnaGJvcikgPT09IC0xKSB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5wb3NzaWJpbGl0aWVzLmdldChuZWlnaGJvcikuaW5kZXhPZih2YWx1ZSk7XG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KG5laWdoYm9yKS5zbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZShhc3NpZ25lbWVudDogTWFwPHN0cmluZywgbnVtYmVyPiwgdmFyaWFibGU6IHN0cmluZykge1xuICAgIGFzc2lnbmVtZW50LmRlbGV0ZSh2YXJpYWJsZSk7XG4gIH1cblxuICBwcml2YXRlIGJhY2t0cmFja2luZyhhc3NpZ25lbWVudDogTWFwPHN0cmluZywgbnVtYmVyPikge1xuICAgIGlmIChhc3NpZ25lbWVudC5zaXplID09PSB0aGlzLnZhcmlhYmxlcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBhc3NpZ25lbWVudDtcbiAgICB9XG4gICAgY29uc3QgdmFyaWFibGUgPSB0aGlzLnNlbGVjdFVuYXNzaWduZWRWYXJpYWJsZXMoYXNzaWduZW1lbnQpO1xuXG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0aGlzLm9yZGVyRG9tYWluc1ZhbHVlcyh2YXJpYWJsZSkpIHtcbiAgICAgIGlmICh0aGlzLmlzQ29uc2lzdGVudChhc3NpZ25lbWVudCwgdmFyaWFibGUsIHZhbHVlKSkge1xuICAgICAgICB0aGlzLmFzc2lnbihhc3NpZ25lbWVudCwgdmFyaWFibGUsIHZhbHVlKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmJhY2t0cmFja2luZyhhc3NpZ25lbWVudCk7XG5cbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW1vdmUoYXNzaWduZW1lbnQsIHZhcmlhYmxlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHVibGljIHByb2Nlc3MoKTogW2Jvb2xlYW4sIE1hcDxzdHJpbmcsIG51bWJlcltdPl0ge1xuICAgIGlmICh0aGlzLmFjMygpKSB7XG4gICAgICAvLyBvbiB2w6lyaWZpZSBzaSBsZSBzdWRva3UgZXN0IGNvbXBsZXRcbiAgICAgIGNvbnN0IGlzRmluaXNoZWQgPVxuICAgICAgICBbLi4udGhpcy5wb3NzaWJpbGl0aWVzLnZhbHVlcygpXS5maWx0ZXIodiA9PiB2Lmxlbmd0aCAhPT0gMSkubGVuZ3RoID09PVxuICAgICAgICAwO1xuICAgICAgaWYgKCFpc0ZpbmlzaGVkKSB7XG4gICAgICAgIGxldCBhc3NpZ25lbWVudCA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gICAgICAgIGZvciAoY29uc3QgdiBvZiB0aGlzLnZhcmlhYmxlcykge1xuICAgICAgICAgIGlmICh0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KHYpLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgYXNzaWduZW1lbnQuc2V0KHYsIHRoaXMucG9zc2liaWxpdGllcy5nZXQodilbMF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBhc3NpZ25lbWVudCA9IHRoaXMuYmFja3RyYWNraW5nKGFzc2lnbmVtZW50KTtcblxuICAgICAgICAgIGlmICghYXNzaWduZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJQb3NzaWJpbGl0aWVzKHRoaXMucG9zc2liaWxpdGllcyk7XG4gICAgICAgICAgICByZXR1cm4gW2ZhbHNlLCB0aGlzLnBvc3NpYmlsaXRpZXNdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZvciAoY29uc3QgW3ZhcmlhYmxlLCB2YWx1ZV0gb2YgYXNzaWduZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMucG9zc2liaWxpdGllcy5zZXQodmFyaWFibGUsIFt2YWx1ZV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIFt0cnVlLCB0aGlzLnBvc3NpYmlsaXRpZXNdO1xuICAgIH1cbiAgICB0aGlzLmNsZWFyUG9zc2liaWxpdGllcyh0aGlzLnBvc3NpYmlsaXRpZXMpO1xuICAgIHJldHVybiBbZmFsc2UsIHRoaXMucG9zc2liaWxpdGllc107XG4gIH1cblxuICBwcml2YXRlIGNsZWFyUG9zc2liaWxpdGllcyhwb3NzaWJpbGl0ZXM6IE1hcDxzdHJpbmcsIG51bWJlcltdPikge1xuICAgIGZvciAoY29uc3Qga2V5IG9mIHBvc3NpYmlsaXRlcy5rZXlzKCkpIHtcbiAgICAgIHBvc3NpYmlsaXRlcy5zZXQoa2V5LCBbMF0pO1xuICAgIH1cbiAgfVxufVxuXG4vLyBVVElMSVRZIEZVTkNUSU9OU1xuXG4vLyBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9heGVscGFsZS8zMTE4NTk2XG5jb25zdCBrQ29tYmluYXRpb25zID0gPFQ+KHNldDogVFtdLCBrOiBudW1iZXIpID0+IHtcbiAgaWYgKGsgPiBzZXQubGVuZ3RoIHx8IGsgPD0gMCkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIGlmIChrID09PSBzZXQubGVuZ3RoKSB7XG4gICAgcmV0dXJuIFtzZXRdO1xuICB9XG5cbiAgaWYgKGsgPT09IDEpIHtcbiAgICByZXR1cm4gc2V0LnJlZHVjZSgoYWNjLCBjdXIpID0+IFsuLi5hY2MsIFtjdXJdXSwgW10gYXMgVFtdW10pO1xuICB9XG5cbiAgY29uc3QgY29tYnMgPSBbXSBhcyBUW11bXTtcbiAgbGV0IHRhaWxfY29tYnMgPSBbXTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8PSBzZXQubGVuZ3RoIC0gayArIDE7IGkrKykge1xuICAgIHRhaWxfY29tYnMgPSBrQ29tYmluYXRpb25zKHNldC5zbGljZShpICsgMSksIGsgLSAxKTtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRhaWxfY29tYnMubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbWJzLnB1c2goW3NldFtpXSwgLi4udGFpbF9jb21ic1tqXV0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjb21icztcbn07XG5cbmNvbnN0IGNyb3NzID0gKEE6IHN0cmluZywgQjogc3RyaW5nKTogQXJyYXk8c3RyaW5nPiA9PiB7XG4gIGxldCByZXMgPSBuZXcgQXJyYXk8c3RyaW5nPigpO1xuICBmb3IgKGxldCBfYSBvZiBBKSB7XG4gICAgZm9yIChsZXQgX2Igb2YgQikge1xuICAgICAgcmVzLnB1c2goX2EgKyBcIlwiICsgX2IpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzO1xufTtcbiJdfQ==