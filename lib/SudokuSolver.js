"use strict";

const BOX_SIZE = 3;
const SIZE = BOX_SIZE * BOX_SIZE;
const COLUMNS = "012345678";
const ROWS = "ABCDEFGHI";

class Sudoku {
  static getBoardFromHtml() {
    let cells = new Map();
    const rootInput = document.querySelector("#sudokuInput");
    const inputs = rootInput.querySelectorAll("input[type=text]");
    inputs.forEach(input => {
      const x = input.getAttribute("data-x");
      if (cells[x] === undefined) cells[x] = [];
      const y = input.getAttribute("data-y");
      const value = input.value;
      cells.set(y + "" + x, value === "" ? [0] : [parseInt(value)]);
    });
    return cells;
  }

  static displayBoard(cells, id) {
    const rootInput = document.querySelector(id);
    const inputs = rootInput.querySelectorAll("input[type=text]");
    inputs.forEach(input => {
      const x = input.getAttribute("data-x");
      const y = input.getAttribute("data-y");
      input.value = cells.get(y + "" + x)[0] !== 0 ? cells.get(y + "" + x).toString() : "";
      input.disabled = true;
    });
  }

  static resolve() {
    let $resultTitle = document.querySelector(".result-title");
    $resultTitle.classList.remove("not-resolved", "resolved");
    let $loadingBox = document.querySelector(".loader-box");
    let $sudokuTable = document.querySelector("#sudokuSolution");
    $sudokuTable.classList.add("loading");
    $loadingBox.classList.add("is-loading");
    let cells = Sudoku.getBoardFromHtml();
    this.sudokuSolver = new SudokuSolver(cells);
    const [isResolved, resolvedCells] = this.sudokuSolver.process();
    $sudokuTable.classList.remove("loading");
    $loadingBox.classList.remove("is-loading");

    if (!isResolved) {
      $resultTitle.innerHTML = "Non rÃ©solvable.";
      $resultTitle.classList.add("not-resolved");
      return;
    }

    $resultTitle.innerHTML = "RÃ©solu. ðŸ˜Ž";
    $resultTitle.classList.add("resolved");
    Sudoku.displayBoard(resolvedCells, "#sudokuSolution"); // On affiche le sudoku sur la partie droite de l'Ã©cran.
  }

  static generateSudoku(level) {
    let grid;

    if (level === 0) {
      grid = '[["A0",[0]],["A1",[0]],["A2",[0]],["A3",[2]],["A4",[6]],["A5",[0]],["A6",[7]],["A7",[0]],["A8",[1]],["B0",[6]],["B1",[8]],["B2",[0]],["B3",[0]],["B4",[7]],["B5",[0]],["B6",[0]],["B7",[9]],["B8",[0]],["C0",[1]],["C1",[9]],["C2",[0]],["C3",[0]],["C4",[0]],["C5",[4]],["C6",[5]],["C7",[0]],["C8",[0]],["D0",[8]],["D1",[2]],["D2",[0]],["D3",[1]],["D4",[0]],["D5",[0]],["D6",[0]],["D7",[4]],["D8",[0]],["E0",[0]],["E1",[0]],["E2",[4]],["E3",[6]],["E4",[0]],["E5",[2]],["E6",[9]],["E7",[0]],["E8",[0]],["F0",[0]],["F1",[5]],["F2",[0]],["F3",[0]],["F4",[0]],["F5",[3]],["F6",[0]],["F7",[2]],["F8",[8]],["G0",[0]],["G1",[0]],["G2",[9]],["G3",[3]],["G4",[0]],["G5",[0]],["G6",[0]],["G7",[7]],["G8",[4]],["H0",[0]],["H1",[4]],["H2",[0]],["H3",[0]],["H4",[5]],["H5",[0]],["H6",[0]],["H7",[3]],["H8",[6]],["I0",[7]],["I1",[0]],["I2",[3]],["I3",[0]],["I4",[1]],["I5",[8]],["I6",[0]],["I7",[0]],["I8",[0]]]';
    } else if (level === 1) {
      grid = '[["A0",[5]],["A1",[0]],["A2",[1]],["A3",[0]],["A4",[0]],["A5",[0]],["A6",[6]],["A7",[0]],["A8",[4]],["B0",[0]],["B1",[9]],["B2",[0]],["B3",[3]],["B4",[0]],["B5",[6]],["B6",[0]],["B7",[5]],["B8",[0]],["C0",[0]],["C1",[0]],["C2",[0]],["C3",[0]],["C4",[9]],["C5",[0]],["C6",[0]],["C7",[0]],["C8",[0]],["D0",[4]],["D1",[0]],["D2",[0]],["D3",[0]],["D4",[0]],["D5",[0]],["D6",[0]],["D7",[0]],["D8",[9]],["E0",[0]],["E1",[0]],["E2",[0]],["E3",[1]],["E4",[0]],["E5",[9]],["E6",[0]],["E7",[0]],["E8",[0]],["F0",[7]],["F1",[0]],["F2",[0]],["F3",[0]],["F4",[0]],["F5",[0]],["F6",[0]],["F7",[0]],["F8",[6]],["G0",[0]],["G1",[0]],["G2",[0]],["G3",[0]],["G4",[2]],["G5",[0]],["G6",[0]],["G7",[0]],["G8",[0]],["H0",[0]],["H1",[8]],["H2",[0]],["H3",[5]],["H4",[0]],["H5",[7]],["H6",[0]],["H7",[6]],["H8",[0]],["I0",[1]],["I1",[0]],["I2",[3]],["I3",[0]],["I4",[0]],["I5",[0]],["I6",[7]],["I7",[0]],["I8",[2]]]';
    } else if (level === 2) {
      grid = '[["A0",[0]],["A1",[0]],["A2",[0]],["A3",[0]],["A4",[0]],["A5",[0]],["A6",[0]],["A7",[0]],["A8",[0]],["B0",[0]],["B1",[0]],["B2",[0]],["B3",[0]],["B4",[0]],["B5",[3]],["B6",[0]],["B7",[8]],["B8",[5]],["C0",[0]],["C1",[0]],["C2",[1]],["C3",[0]],["C4",[2]],["C5",[0]],["C6",[0]],["C7",[0]],["C8",[0]],["D0",[0]],["D1",[0]],["D2",[0]],["D3",[5]],["D4",[0]],["D5",[7]],["D6",[0]],["D7",[0]],["D8",[0]],["E0",[0]],["E1",[0]],["E2",[4]],["E3",[0]],["E4",[0]],["E5",[0]],["E6",[1]],["E7",[0]],["E8",[0]],["F0",[0]],["F1",[9]],["F2",[0]],["F3",[0]],["F4",[0]],["F5",[0]],["F6",[0]],["F7",[0]],["F8",[0]],["G0",[5]],["G1",[0]],["G2",[0]],["G3",[0]],["G4",[0]],["G5",[0]],["G6",[0]],["G7",[7]],["G8",[3]],["H0",[0]],["H1",[0]],["H2",[2]],["H3",[0]],["H4",[1]],["H5",[0]],["H6",[0]],["H7",[0]],["H8",[0]],["I0",[0]],["I1",[0]],["I2",[0]],["I3",[0]],["I4",[4]],["I5",[0]],["I6",[0]],["I7",[0]],["I8",[9]]]';
    }

    this.displayBoard(new Map(JSON.parse(grid)), "#sudokuInput");
  }

}

class SudokuSolver {
  constructor(board) {
    this.board = board;
    this.variables = cross(ROWS, COLUMNS);
    this.neighbors = new Map();
    this.possibilities = new Map();
    this.binary_constraints = new Array(); // GENERATION DES POSSIBILITES

    for (const [variable, value] of this.board) {
      this.possibilities.set(variable, value[0] === 0 ? [1, 2, 3, 4, 5, 6, 7, 8, 9] : value);
    } // GENERATION DES CONTRAINTES


    let row_constraints = new Array();
    let box_constraints = new Array();
    let column_constraints = new Array();

    for (let i = 0; i < ROWS.length; i++) {
      column_constraints.push(cross(ROWS[i], COLUMNS));
      row_constraints.push(cross(ROWS, COLUMNS[i]));
    }

    for (const _bi of ["ABC", "DEF", "GHI"]) {
      for (const _bj of ["012", "345", "678"]) {
        box_constraints.push(cross(_bi, _bj));
      }
    } // Transformation en contraintes binaires
    // Les permutations viennent le loadash et sont importÃ©s dans le HTML.


    for (const c of column_constraints) {
      this.binary_constraints.push(...permutations(c, 2));
    }

    for (const c of row_constraints) {
      this.binary_constraints.push(...permutations(c, 2));
    }

    for (const c of box_constraints) {
      this.binary_constraints.push(...permutations(c, 2));
    } // GENERATION DES VOISINS


    for (const v of this.variables) {
      this.neighbors.set(v, new Array());

      for (const c of this.binary_constraints) {
        if (v === c[0]) this.neighbors.get(v).push(c[1]);
      }
    }
  } // Insipired by http://aima.cs.berkeley.edu/python/csp.html.


  ac3() {
    let queue = [...this.binary_constraints]; // on clone les contraintes binaires.

    while (queue.length !== 0) {
      const [a, b] = queue.pop();

      if (this.removeInconsistentValues(a, b)) {
        if (this.possibilities.get(a).length === 0) return false;

        for (const n of this.neighbors.get(a)) {
          if (n !== a) {
            queue.push([n, a]);
          }
        }
      }
    }

    return true;
  }
  /**
   * On vÃ©rifie s'il y a des valeurs possibles communes etre a et b, si oui on enlÃ¨ve la possibiltiÃ© dans a.
   * @param a
   * @param b
   * @returns si une valeur Ã  Ã©tÃ© supprimÃ©e.
   */


  removeInconsistentValues(a, b) {
    let removed = false;

    for (const value of this.possibilities.get(a)) {
      let conflict = false;

      for (const poss of this.possibilities.get(b)) {
        if (poss !== value) {
          conflict = true;
          break;
        }
      }

      if (!conflict) {
        const index = this.possibilities.get(a).indexOf(value);
        this.possibilities.get(a).splice(index, 1);
        removed = true;
      }
    }

    return removed;
  } // MRV : On choisit la cellule (variable) avec le moins de possibilitÃ©.


  selectUnassignedVariables(assignement) {
    const unassigned = this.variables.filter(v => [...assignement.keys()].indexOf(v) === -1);
    let min = 10;
    let minV = undefined;

    for (const [variable, poss] of this.possibilities) {
      if (unassigned.indexOf(variable) === -1) continue;

      if (poss.length <= min) {
        min = poss.length;
        minV = variable;
      }
    }

    return minV;
  }
  /**
   * On calcul les conflits existants avec les cellules voisines.
   * Est utilisÃ© dans LCV.
   * @param variable
   * @param value
   */


  conflicts(variable, value) {
    let nbConflicts = 0;

    for (let neighbor of this.neighbors.get(variable)) {
      // Si l'intersection des deux possibilitÃ©s n'est pas vide
      if (this.possibilities.get(neighbor).length > 1 && this.possibilities.get(neighbor).indexOf(value) !== -1) {
        nbConflicts++;
      }
    }

    return nbConflicts;
  } // LCV : On choisit une valeur qui Ã  le moins d'impact sur les variables voisines


  orderDomainsValues(variable) {
    let poss = this.possibilities.get(variable);
    return poss.sort((a, b) => {
      return this.conflicts(variable, a) - this.conflicts(variable, b);
    });
  }
  /**
   * On s'assure que la variable n'est pas inconsistente avec les assignements
   * @param assignement
   * @param variable
   * @param value
   */


  isConsistent(assignement, variable, value) {
    for (const [_variable, _value] of assignement) {
      // si deux variables ont la mÃªme valeur et qu'elles sont voisines alors inconsistent.
      if (_value === value && this.neighbors.get(variable).indexOf(_variable) !== -1) {
        return false;
      }
    }

    return true;
  }

  assign(assignement, variable, value) {
    assignement.set(variable, value);
    this.forwardCheck(assignement, variable, value);
  }
  /**
   * On enlÃ¨ve dans la liste des possibilitÃ©s des cellules voisines la valeur qu'on vient d'attribuer Ã  la variable
   * @param assignement
   * @param variable
   * @param value
   */


  forwardCheck(assignement, variable, value) {
    for (const neighbor of this.neighbors.get(variable)) {
      if ([...assignement.keys()].indexOf(neighbor) === -1) {
        const index = this.possibilities.get(neighbor).indexOf(value);

        if (index !== -1) {
          this.possibilities.get(neighbor).slice(index, 1);
        }
      }
    }
  }

  remove(assignement, variable) {
    assignement.delete(variable);
  }
  /**
   * Pseudo code : https://www.cpp.edu/~ftang/courses/CS420/notes/CSP.pdf
   * @param assignement
   */


  backtracking(assignement) {
    if (assignement.size === this.variables.length) {
      return assignement;
    }

    const variable = this.selectUnassignedVariables(assignement);

    for (const value of this.orderDomainsValues(variable)) {
      if (this.isConsistent(assignement, variable, value)) {
        this.assign(assignement, variable, value);
        const result = this.backtracking(assignement);

        if (result) {
          return result;
        }

        this.remove(assignement, variable);
      }
    }

    return false;
  }

  clearPossibilities(possibilites) {
    for (const key of possibilites.keys()) {
      possibilites.set(key, [0]);
    }
  }

  process() {
    if (this.ac3()) {
      // on vÃ©rifie si le sudoku est complet
      const isFinished = [...this.possibilities.values()].filter(v => v.length !== 1).length === 0;

      if (!isFinished) {
        let assignement = new Map();

        for (const v of this.variables) {
          if (this.possibilities.get(v).length === 1) {
            assignement.set(v, this.possibilities.get(v)[0]);
          }

          assignement = this.backtracking(assignement);

          if (!assignement) {
            this.clearPossibilities(this.possibilities);
            return [false, this.possibilities];
          }

          for (const [variable, value] of assignement) {
            this.possibilities.set(variable, [value]);
          }
        }
      }

      return [true, this.possibilities];
    }

    this.clearPossibilities(this.possibilities);
    return [false, this.possibilities];
  }

} // UTILITY FUNCTIONS


const cross = (A, B) => {
  let res = new Array();

  for (let _a of A) {
    for (let _b of B) {
      res.push(_a + "" + _b);
    }
  }

  return res;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TdWRva3VTb2x2ZXIudHMiXSwibmFtZXMiOlsiQk9YX1NJWkUiLCJTSVpFIiwiQ09MVU1OUyIsIlJPV1MiLCJTdWRva3UiLCJnZXRCb2FyZEZyb21IdG1sIiwiY2VsbHMiLCJNYXAiLCJyb290SW5wdXQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbnB1dHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImlucHV0IiwieCIsImdldEF0dHJpYnV0ZSIsInVuZGVmaW5lZCIsInkiLCJ2YWx1ZSIsInNldCIsInBhcnNlSW50IiwiZGlzcGxheUJvYXJkIiwiaWQiLCJnZXQiLCJ0b1N0cmluZyIsImRpc2FibGVkIiwicmVzb2x2ZSIsIiRyZXN1bHRUaXRsZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsIiRsb2FkaW5nQm94IiwiJHN1ZG9rdVRhYmxlIiwiYWRkIiwic3Vkb2t1U29sdmVyIiwiU3Vkb2t1U29sdmVyIiwiaXNSZXNvbHZlZCIsInJlc29sdmVkQ2VsbHMiLCJwcm9jZXNzIiwiaW5uZXJIVE1MIiwiZ2VuZXJhdGVTdWRva3UiLCJsZXZlbCIsImdyaWQiLCJKU09OIiwicGFyc2UiLCJjb25zdHJ1Y3RvciIsImJvYXJkIiwidmFyaWFibGVzIiwiY3Jvc3MiLCJuZWlnaGJvcnMiLCJwb3NzaWJpbGl0aWVzIiwiYmluYXJ5X2NvbnN0cmFpbnRzIiwiQXJyYXkiLCJ2YXJpYWJsZSIsInJvd19jb25zdHJhaW50cyIsImJveF9jb25zdHJhaW50cyIsImNvbHVtbl9jb25zdHJhaW50cyIsImkiLCJsZW5ndGgiLCJwdXNoIiwiX2JpIiwiX2JqIiwiYyIsInBlcm11dGF0aW9ucyIsInYiLCJhYzMiLCJxdWV1ZSIsImEiLCJiIiwicG9wIiwicmVtb3ZlSW5jb25zaXN0ZW50VmFsdWVzIiwibiIsInJlbW92ZWQiLCJjb25mbGljdCIsInBvc3MiLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJzZWxlY3RVbmFzc2lnbmVkVmFyaWFibGVzIiwiYXNzaWduZW1lbnQiLCJ1bmFzc2lnbmVkIiwiZmlsdGVyIiwia2V5cyIsIm1pbiIsIm1pblYiLCJjb25mbGljdHMiLCJuYkNvbmZsaWN0cyIsIm5laWdoYm9yIiwib3JkZXJEb21haW5zVmFsdWVzIiwic29ydCIsImlzQ29uc2lzdGVudCIsIl92YXJpYWJsZSIsIl92YWx1ZSIsImFzc2lnbiIsImZvcndhcmRDaGVjayIsInNsaWNlIiwiZGVsZXRlIiwiYmFja3RyYWNraW5nIiwic2l6ZSIsInJlc3VsdCIsImNsZWFyUG9zc2liaWxpdGllcyIsInBvc3NpYmlsaXRlcyIsImtleSIsImlzRmluaXNoZWQiLCJ2YWx1ZXMiLCJBIiwiQiIsInJlcyIsIl9hIiwiX2IiXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsUUFBUSxHQUFHLENBQWpCO0FBQ0EsTUFBTUMsSUFBSSxHQUFHRCxRQUFRLEdBQUdBLFFBQXhCO0FBQ0EsTUFBTUUsT0FBZSxHQUFHLFdBQXhCO0FBQ0EsTUFBTUMsSUFBWSxHQUFHLFdBQXJCOztBQUVBLE1BQU1DLE1BQU4sQ0FBYTtBQUdYLFNBQWVDLGdCQUFmLEdBQXlEO0FBQ3ZELFFBQUlDLEtBQTRCLEdBQUcsSUFBSUMsR0FBSixFQUFuQztBQUNBLFVBQU1DLFNBQVMsR0FBR0MsUUFBUSxDQUFDQyxhQUFULENBQXVCLGNBQXZCLENBQWxCO0FBQ0EsVUFBTUMsTUFBTSxHQUFHSCxTQUFTLENBQUNJLGdCQUFWLENBQTJCLGtCQUEzQixDQUFmO0FBQ0FELElBQUFBLE1BQU0sQ0FBQ0UsT0FBUCxDQUFnQkMsS0FBRCxJQUE2QjtBQUMxQyxZQUFNQyxDQUFDLEdBQUdELEtBQUssQ0FBQ0UsWUFBTixDQUFtQixRQUFuQixDQUFWO0FBQ0EsVUFBSVYsS0FBSyxDQUFDUyxDQUFELENBQUwsS0FBYUUsU0FBakIsRUFBNEJYLEtBQUssQ0FBQ1MsQ0FBRCxDQUFMLEdBQVcsRUFBWDtBQUM1QixZQUFNRyxDQUFDLEdBQUdKLEtBQUssQ0FBQ0UsWUFBTixDQUFtQixRQUFuQixDQUFWO0FBQ0EsWUFB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QXZCLEVBQWlDLENBQUNsQyxLQUFELENBQWpDO0FBQ0Q7QUFDRjtBQUNGOztBQUNELGFBQU8sQ0FBQyxJQUFELEVBQU8sS0FBSytCLGFBQVosQ0FBUDtBQUNEOztBQUNELFNBQUtrRCxrQkFBTCxDQUF3QixLQUFLbEQsYUFBN0I7QUFDQSxXQUFPLENBQUMsS0FBRCxFQUFRLEtBQUtBLGFBQWIsQ0FBUDtBQUNEOztBQTlRZ0IsQyxDQWlSbkI7OztBQUVBLE1BQU1GLEtBQUssR0FBRyxDQUFDeUQsQ0FBRCxFQUFZQyxDQUFaLEtBQXlDO0FBQ3JELE1BQUlDLEdBQUcsR0FBRyxJQUFJdkQsS0FBSixFQUFWOztBQUNBLE9BQUssSUFBSXdELEVBQVQsSUFBZUgsQ0FBZixFQUFrQjtBQUNoQixTQUFLLElBQUlJLEVBQVQsSUFBZUgsQ0FBZixFQUFrQjtBQUNoQkMsTUFBQUEsR0FBRyxDQUFDaEQsSUFBSixDQUFTaUQsRUFBRSxHQUFHLEVBQUwsR0FBVUMsRUFBbkI7QUFDRDtBQUNGOztBQUNELFNBQU9GLEdBQVA7QUFDRCxDQVJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQk9YX1NJWkUgPSAzO1xuY29uc3QgU0laRSA9IEJPWF9TSVpFICogQk9YX1NJWkU7XG5jb25zdCBDT0xVTU5TOiBzdHJpbmcgPSBcIjAxMjM0NTY3OFwiO1xuY29uc3QgUk9XUzogc3RyaW5nID0gXCJBQkNERUZHSElcIjtcblxuY2xhc3MgU3Vkb2t1IHtcbiAgc3RhdGljIHN1ZG9rdVNvbHZlcjogU3Vkb2t1U29sdmVyO1xuXG4gIHByaXZhdGUgc3RhdGljIGdldEJvYXJkRnJvbUh0bWwoKTogTWFwPHN0cmluZywgbnVtYmVyW10+IHtcbiAgICBsZXQgY2VsbHM6IE1hcDxzdHJpbmcsIG51bWJlcltdPiA9IG5ldyBNYXAoKTtcbiAgICBjb25zdCByb290SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3N1ZG9rdUlucHV0XCIpO1xuICAgIGNvbnN0IGlucHV0cyA9IHJvb3RJbnB1dC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXRbdHlwZT10ZXh0XVwiKTtcbiAgICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIGNvbnN0IHggPSBpbnB1dC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXhcIik7XG4gICAgICBpZiAoY2VsbHNbeF0gPT09IHVuZGVmaW5lZCkgY2VsbHNbeF0gPSBbXTtcbiAgICAgIGNvbnN0IHkgPSBpbnB1dC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXlcIik7XG4gICAgICBjb25zdCB2YWx1ZSA9IGlucHV0LnZhbHVlO1xuICAgICAgY2VsbHMuc2V0KHkgKyBcIlwiICsgeCwgdmFsdWUgPT09IFwiXCIgPyBbMF0gOiBbcGFyc2VJbnQodmFsdWUpXSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGNlbGxzO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZGlzcGxheUJvYXJkKGNlbGxzOiBNYXA8c3RyaW5nLCBudW1iZXJbXT4sIGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCByb290SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkKTtcbiAgICBjb25zdCBpbnB1dHMgPSByb290SW5wdXQucXVlcnlTZWxlY3RvckFsbChcImlucHV0W3R5cGU9dGV4dF1cIik7XG4gICAgaW5wdXRzLmZvckVhY2goKGlucHV0OiBIVE1MSW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBjb25zdCB4ID0gaW5wdXQuZ2V0QXR0cmlidXRlKFwiZGF0YS14XCIpO1xuICAgICAgY29uc3QgeSA9IGlucHV0LmdldEF0dHJpYnV0ZShcImRhdGEteVwiKTtcbiAgICAgIGlucHV0LnZhbHVlID1cbiAgICAgICAgY2VsbHMuZ2V0KHkgKyBcIlwiICsgeClbMF0gIT09IDAgPyBjZWxscy5nZXQoeSArIFwiXCIgKyB4KS50b1N0cmluZygpIDogXCJcIjtcbiAgICAgIGlucHV0LmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyByZXNvbHZlKCkge1xuICAgIGxldCAkcmVzdWx0VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdC10aXRsZVwiKTtcbiAgICAkcmVzdWx0VGl0bGUuY2xhc3NMaXN0LnJlbW92ZShcIm5vdC1yZXNvbHZlZFwiLCBcInJlc29sdmVkXCIpO1xuICAgIGxldCAkbG9hZGluZ0JveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubG9hZGVyLWJveFwiKTtcbiAgICBsZXQgJHN1ZG9rdVRhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzdWRva3VTb2x1dGlvblwiKTtcbiAgICAkc3Vkb2t1VGFibGUuY2xhc3NMaXN0LmFkZChcImxvYWRpbmdcIik7XG4gICAgJGxvYWRpbmdCb3guY2xhc3NMaXN0LmFkZChcImlzLWxvYWRpbmdcIik7XG4gICAgbGV0IGNlbGxzID0gU3Vkb2t1LmdldEJvYXJkRnJvbUh0bWwoKTtcblxuICAgIHRoaXMuc3Vkb2t1U29sdmVyID0gbmV3IFN1ZG9rdVNvbHZlcihjZWxscyk7XG4gICAgY29uc3QgW2lzUmVzb2x2ZWQsIHJlc29sdmVkQ2VsbHNdID0gdGhpcy5zdWRva3VTb2x2ZXIucHJvY2VzcygpO1xuICAgICRzdWRva3VUYWJsZS5jbGFzc0xpc3QucmVtb3ZlKFwibG9hZGluZ1wiKTtcbiAgICAkbG9hZGluZ0JveC5jbGFzc0xpc3QucmVtb3ZlKFwiaXMtbG9hZGluZ1wiKTtcbiAgICBpZiAoIWlzUmVzb2x2ZWQpIHtcbiAgICAgICRyZXN1bHRUaXRsZS5pbm5lckhUTUwgPSBcIk5vbiByw6lzb2x2YWJsZS5cIjtcbiAgICAgICRyZXN1bHRUaXRsZS5jbGFzc0xpc3QuYWRkKFwibm90LXJlc29sdmVkXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAkcmVzdWx0VGl0bGUuaW5uZXJIVE1MID0gXCJSw6lzb2x1LiDwn5iOXCI7XG4gICAgJHJlc3VsdFRpdGxlLmNsYXNzTGlzdC5hZGQoXCJyZXNvbHZlZFwiKTtcbiAgICBTdWRva3UuZGlzcGxheUJvYXJkKHJlc29sdmVkQ2VsbHMsIFwiI3N1ZG9rdVNvbHV0aW9uXCIpO1xuICAgIC8vIE9uIGFmZmljaGUgbGUgc3Vkb2t1IHN1ciBsYSBwYXJ0aWUgZHJvaXRlIGRlIGwnw6ljcmFuLlxuICB9XG5cbiAgc3RhdGljIGdlbmVyYXRlU3Vkb2t1KGxldmVsOiBudW1iZXIpIHtcbiAgICBsZXQgZ3JpZDogc3RyaW5nO1xuICAgIGlmIChsZXZlbCA9PT0gMCkge1xuICAgICAgZ3JpZCA9XG4gICAgICAgICdbW1wiQTBcIixbMF1dLFtcIkExXCIsWzBdXSxbXCJBMlwiLFswXV0sW1wiQTNcIixbMl1dLFtcIkE0XCIsWzZdXSxbXCJBNVwiLFswXV0sW1wiQTZcIixbN11dLFtcIkE3XCIsWzBdXSxbXCJBOFwiLFsxXV0sW1wiQjBcIixbNl1dLFtcIkIxXCIsWzhdXSxbXCJCMlwiLFswXV0sW1wiQjNcIixbMF1dLFtcIkI0XCIsWzddXSxbXCJCNVwiLFswXV0sW1wiQjZcIixbMF1dLFtcIkI3XCIsWzldXSxbXCJCOFwiLFswXV0sW1wiQzBcIixbMV1dLFtcIkMxXCIsWzldXSxbXCJDMlwiLFswXV0sW1wiQzNcIixbMF1dLFtcIkM0XCIsWzBdXSxbXCJDNVwiLFs0XV0sW1wiQzZcIixbNV1dLFtcIkM3XCIsWzBdXSxbXCJDOFwiLFswXV0sW1wiRDBcIixbOF1dLFtcIkQxXCIsWzJdXSxbXCJEMlwiLFswXV0sW1wiRDNcIixbMV1dLFtcIkQ0XCIsWzBdXSxbXCJENVwiLFswXV0sW1wiRDZcIixbMF1dLFtcIkQ3XCIsWzRdXSxbXCJEOFwiLFswXV0sW1wiRTBcIixbMF1dLFtcIkUxXCIsWzBdXSxbXCJFMlwiLFs0XV0sW1wiRTNcIixbNl1dLFtcIkU0XCIsWzBdXSxbXCJFNVwiLFsyXV0sW1wiRTZcIixbOV1dLFtcIkU3XCIsWzBdXSxbXCJFOFwiLFswXV0sW1wiRjBcIixbMF1dLFtcIkYxXCIsWzVdXSxbXCJGMlwiLFswXV0sW1wiRjNcIixbMF1dLFtcIkY0XCIsWzBdXSxbXCJGNVwiLFszXV0sW1wiRjZcIixbMF1dLFtcIkY3XCIsWzJdXSxbXCJGOFwiLFs4XV0sW1wiRzBcIixbMF1dLFtcIkcxXCIsWzBdXSxbXCJHMlwiLFs5XV0sW1wiRzNcIixbM11dLFtcIkc0XCIsWzBdXSxbXCJHNVwiLFswXV0sW1wiRzZcIixbMF1dLFtcIkc3XCIsWzddXSxbXCJHOFwiLFs0XV0sW1wiSDBcIixbMF1dLFtcIkgxXCIsWzRdXSxbXCJIMlwiLFswXV0sW1wiSDNcIixbMF1dLFtcIkg0XCIsWzVdXSxbXCJINVwiLFswXV0sW1wiSDZcIixbMF1dLFtcIkg3XCIsWzNdXSxbXCJIOFwiLFs2XV0sW1wiSTBcIixbN11dLFtcIkkxXCIsWzBdXSxbXCJJMlwiLFszXV0sW1wiSTNcIixbMF1dLFtcIkk0XCIsWzFdXSxbXCJJNVwiLFs4XV0sW1wiSTZcIixbMF1dLFtcIkk3XCIsWzBdXSxbXCJJOFwiLFswXV1dJztcbiAgICB9IGVsc2UgaWYgKGxldmVsID09PSAxKSB7XG4gICAgICBncmlkID1cbiAgICAgICAgJ1tbXCJBMFwiLFs1XV0sW1wiQTFcIixbMF1dLFtcIkEyXCIsWzFdXSxbXCJBM1wiLFswXV0sW1wiQTRcIixbMF1dLFtcIkE1XCIsWzBdXSxbXCJBNlwiLFs2XV0sW1wiQTdcIixbMF1dLFtcIkE4XCIsWzRdXSxbXCJCMFwiLFswXV0sW1wiQjFcIixbOV1dLFtcIkIyXCIsWzBdXSxbXCJCM1wiLFszXV0sW1wiQjRcIixbMF1dLFtcIkI1XCIsWzZdXSxbXCJCNlwiLFswXV0sW1wiQjdcIixbNV1dLFtcIkI4XCIsWzBdXSxbXCJDMFwiLFswXV0sW1wiQzFcIixbMF1dLFtcIkMyXCIsWzBdXSxbXCJDM1wiLFswXV0sW1wiQzRcIixbOV1dLFtcIkM1XCIsWzBdXSxbXCJDNlwiLFswXV0sW1wiQzdcIixbMF1dLFtcIkM4XCIsWzBdXSxbXCJEMFwiLFs0XV0sW1wiRDFcIixbMF1dLFtcIkQyXCIsWzBdXSxbXCJEM1wiLFswXV0sW1wiRDRcIixbMF1dLFtcIkQ1XCIsWzBdXSxbXCJENlwiLFswXV0sW1wiRDdcIixbMF1dLFtcIkQ4XCIsWzldXSxbXCJFMFwiLFswXV0sW1wiRTFcIixbMF1dLFtcIkUyXCIsWzBdXSxbXCJFM1wiLFsxXV0sW1wiRTRcIixbMF1dLFtcIkU1XCIsWzldXSxbXCJFNlwiLFswXV0sW1wiRTdcIixbMF1dLFtcIkU4XCIsWzBdXSxbXCJGMFwiLFs3XV0sW1wiRjFcIixbMF1dLFtcIkYyXCIsWzBdXSxbXCJGM1wiLFswXV0sW1wiRjRcIixbMF1dLFtcIkY1XCIsWzBdXSxbXCJGNlwiLFswXV0sW1wiRjdcIixbMF1dLFtcIkY4XCIsWzZdXSxbXCJHMFwiLFswXV0sW1wiRzFcIixbMF1dLFtcIkcyXCIsWzBdXSxbXCJHM1wiLFswXV0sW1wiRzRcIixbMl1dLFtcIkc1XCIsWzBdXSxbXCJHNlwiLFswXV0sW1wiRzdcIixbMF1dLFtcIkc4XCIsWzBdXSxbXCJIMFwiLFswXV0sW1wiSDFcIixbOF1dLFtcIkgyXCIsWzBdXSxbXCJIM1wiLFs1XV0sW1wiSDRcIixbMF1dLFtcIkg1XCIsWzddXSxbXCJINlwiLFswXV0sW1wiSDdcIixbNl1dLFtcIkg4XCIsWzBdXSxbXCJJMFwiLFsxXV0sW1wiSTFcIixbMF1dLFtcIkkyXCIsWzNdXSxbXCJJM1wiLFswXV0sW1wiSTRcIixbMF1dLFtcIkk1XCIsWzBdXSxbXCJJNlwiLFs3XV0sW1wiSTdcIixbMF1dLFtcIkk4XCIsWzJdXV0nO1xuICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09IDIpIHtcbiAgICAgIGdyaWQgPVxuICAgICAgICAnW1tcIkEwXCIsWzBdXSxbXCJBMVwiLFswXV0sW1wiQTJcIixbMF1dLFtcIkEzXCIsWzBdXSxbXCJBNFwiLFswXV0sW1wiQTVcIixbMF1dLFtcIkE2XCIsWzBdXSxbXCJBN1wiLFswXV0sW1wiQThcIixbMF1dLFtcIkIwXCIsWzBdXSxbXCJCMVwiLFswXV0sW1wiQjJcIixbMF1dLFtcIkIzXCIsWzBdXSxbXCJCNFwiLFswXV0sW1wiQjVcIixbM11dLFtcIkI2XCIsWzBdXSxbXCJCN1wiLFs4XV0sW1wiQjhcIixbNV1dLFtcIkMwXCIsWzBdXSxbXCJDMVwiLFswXV0sW1wiQzJcIixbMV1dLFtcIkMzXCIsWzBdXSxbXCJDNFwiLFsyXV0sW1wiQzVcIixbMF1dLFtcIkM2XCIsWzBdXSxbXCJDN1wiLFswXV0sW1wiQzhcIixbMF1dLFtcIkQwXCIsWzBdXSxbXCJEMVwiLFswXV0sW1wiRDJcIixbMF1dLFtcIkQzXCIsWzVdXSxbXCJENFwiLFswXV0sW1wiRDVcIixbN11dLFtcIkQ2XCIsWzBdXSxbXCJEN1wiLFswXV0sW1wiRDhcIixbMF1dLFtcIkUwXCIsWzBdXSxbXCJFMVwiLFswXV0sW1wiRTJcIixbNF1dLFtcIkUzXCIsWzBdXSxbXCJFNFwiLFswXV0sW1wiRTVcIixbMF1dLFtcIkU2XCIsWzFdXSxbXCJFN1wiLFswXV0sW1wiRThcIixbMF1dLFtcIkYwXCIsWzBdXSxbXCJGMVwiLFs5XV0sW1wiRjJcIixbMF1dLFtcIkYzXCIsWzBdXSxbXCJGNFwiLFswXV0sW1wiRjVcIixbMF1dLFtcIkY2XCIsWzBdXSxbXCJGN1wiLFswXV0sW1wiRjhcIixbMF1dLFtcIkcwXCIsWzVdXSxbXCJHMVwiLFswXV0sW1wiRzJcIixbMF1dLFtcIkczXCIsWzBdXSxbXCJHNFwiLFswXV0sW1wiRzVcIixbMF1dLFtcIkc2XCIsWzBdXSxbXCJHN1wiLFs3XV0sW1wiRzhcIixbM11dLFtcIkgwXCIsWzBdXSxbXCJIMVwiLFswXV0sW1wiSDJcIixbMl1dLFtcIkgzXCIsWzBdXSxbXCJINFwiLFsxXV0sW1wiSDVcIixbMF1dLFtcIkg2XCIsWzBdXSxbXCJIN1wiLFswXV0sW1wiSDhcIixbMF1dLFtcIkkwXCIsWzBdXSxbXCJJMVwiLFswXV0sW1wiSTJcIixbMF1dLFtcIkkzXCIsWzBdXSxbXCJJNFwiLFs0XV0sW1wiSTVcIixbMF1dLFtcIkk2XCIsWzBdXSxbXCJJN1wiLFswXV0sW1wiSThcIixbOV1dXSc7XG4gICAgfVxuICAgIHRoaXMuZGlzcGxheUJvYXJkKG5ldyBNYXAoSlNPTi5wYXJzZShncmlkKSksIFwiI3N1ZG9rdUlucHV0XCIpO1xuICB9XG59XG5cbmNsYXNzIFN1ZG9rdVNvbHZlciB7XG4gIGJvYXJkOiBNYXA8c3RyaW5nLCBudW1iZXJbXT47XG4gIHZhcmlhYmxlczogQXJyYXk8c3RyaW5nPjtcbiAgYmluYXJ5X2NvbnN0cmFpbnRzOiBBcnJheTxBcnJheTxzdHJpbmc+PjtcbiAgbmVpZ2hib3JzOiBNYXA8c3RyaW5nLCBBcnJheTxzdHJpbmc+PjtcbiAgcG9zc2liaWxpdGllczogTWFwPHN0cmluZywgQXJyYXk8bnVtYmVyPj47XG5cbiAgY29uc3RydWN0b3IoYm9hcmQ6IE1hcDxzdHJpbmcsIG51bWJlcltdPikge1xuICAgIHRoaXMuYm9hcmQgPSBib2FyZDtcbiAgICB0aGlzLnZhcmlhYmxlcyA9IGNyb3NzKFJPV1MsIENPTFVNTlMpO1xuICAgIHRoaXMubmVpZ2hib3JzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMucG9zc2liaWxpdGllcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLmJpbmFyeV9jb25zdHJhaW50cyA9IG5ldyBBcnJheSgpO1xuXG4gICAgLy8gR0VORVJBVElPTiBERVMgUE9TU0lCSUxJVEVTXG5cbiAgICBmb3IgKGNvbnN0IFt2YXJpYWJsZSwgdmFsdWVdIG9mIHRoaXMuYm9hcmQpIHtcbiAgICAgIHRoaXMucG9zc2liaWxpdGllcy5zZXQoXG4gICAgICAgIHZhcmlhYmxlLFxuICAgICAgICB2YWx1ZVswXSA9PT0gMCA/IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5XSA6IHZhbHVlXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEdFTkVSQVRJT04gREVTIENPTlRSQUlOVEVTXG5cbiAgICBsZXQgcm93X2NvbnN0cmFpbnRzID0gbmV3IEFycmF5PEFycmF5PHN0cmluZz4+KCk7XG4gICAgbGV0IGJveF9jb25zdHJhaW50cyA9IG5ldyBBcnJheTxBcnJheTxzdHJpbmc+PigpO1xuICAgIGxldCBjb2x1bW5fY29uc3RyYWludHMgPSBuZXcgQXJyYXk8QXJyYXk8c3RyaW5nPj4oKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgUk9XUy5sZW5ndGg7IGkrKykge1xuICAgICAgY29sdW1uX2NvbnN0cmFpbnRzLnB1c2goY3Jvc3MoUk9XU1tpXSwgQ09MVU1OUykpO1xuICAgICAgcm93X2NvbnN0cmFpbnRzLnB1c2goY3Jvc3MoUk9XUywgQ09MVU1OU1tpXSkpO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgX2JpIG9mIFtcIkFCQ1wiLCBcIkRFRlwiLCBcIkdISVwiXSkge1xuICAgICAgZm9yIChjb25zdCBfYmogb2YgW1wiMDEyXCIsIFwiMzQ1XCIsIFwiNjc4XCJdKSB7XG4gICAgICAgIGJveF9jb25zdHJhaW50cy5wdXNoKGNyb3NzKF9iaSwgX2JqKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVHJhbnNmb3JtYXRpb24gZW4gY29udHJhaW50ZXMgYmluYWlyZXNcblxuICAgIC8vIExlcyBwZXJtdXRhdGlvbnMgdmllbm5lbnQgbGUgbG9hZGFzaCBldCBzb250IGltcG9ydMOpcyBkYW5zIGxlIEhUTUwuXG4gICAgZm9yIChjb25zdCBjIG9mIGNvbHVtbl9jb25zdHJhaW50cykge1xuICAgICAgdGhpcy5iaW5hcnlfY29uc3RyYWludHMucHVzaCguLi5wZXJtdXRhdGlvbnMoYywgMikpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGMgb2Ygcm93X2NvbnN0cmFpbnRzKSB7XG4gICAgICB0aGlzLmJpbmFyeV9jb25zdHJhaW50cy5wdXNoKC4uLnBlcm11dGF0aW9ucyhjLCAyKSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgYyBvZiBib3hfY29uc3RyYWludHMpIHtcbiAgICAgIHRoaXMuYmluYXJ5X2NvbnN0cmFpbnRzLnB1c2goLi4ucGVybXV0YXRpb25zKGMsIDIpKTtcbiAgICB9XG5cbiAgICAvLyBHRU5FUkFUSU9OIERFUyBWT0lTSU5TXG5cbiAgICBmb3IgKGNvbnN0IHYgb2YgdGhpcy52YXJpYWJsZXMpIHtcbiAgICAgIHRoaXMubmVpZ2hib3JzLnNldCh2LCBuZXcgQXJyYXk8c3RyaW5nPigpKTtcbiAgICAgIGZvciAoY29uc3QgYyBvZiB0aGlzLmJpbmFyeV9jb25zdHJhaW50cykge1xuICAgICAgICBpZiAodiA9PT0gY1swXSkgdGhpcy5uZWlnaGJvcnMuZ2V0KHYpLnB1c2goY1sxXSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gSW5zaXBpcmVkIGJ5IGh0dHA6Ly9haW1hLmNzLmJlcmtlbGV5LmVkdS9weXRob24vY3NwLmh0bWwuXG4gIHB1YmxpYyBhYzMoKTogYm9vbGVhbiB7XG4gICAgbGV0IHF1ZXVlID0gWy4uLnRoaXMuYmluYXJ5X2NvbnN0cmFpbnRzXTsgLy8gb24gY2xvbmUgbGVzIGNvbnRyYWludGVzIGJpbmFpcmVzLlxuXG4gICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCAhPT0gMCkge1xuICAgICAgY29uc3QgW2EsIGJdID0gcXVldWUucG9wKCk7XG5cbiAgICAgIGlmICh0aGlzLnJlbW92ZUluY29uc2lzdGVudFZhbHVlcyhhLCBiKSkge1xuICAgICAgICBpZiAodGhpcy5wb3NzaWJpbGl0aWVzLmdldChhKS5sZW5ndGggPT09IDApIHJldHVybiBmYWxzZTtcblxuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdGhpcy5uZWlnaGJvcnMuZ2V0KGEpKSB7XG4gICAgICAgICAgaWYgKG4gIT09IGEpIHtcbiAgICAgICAgICAgIHF1ZXVlLnB1c2goW24sIGFdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogT24gdsOpcmlmaWUgcydpbCB5IGEgZGVzIHZhbGV1cnMgcG9zc2libGVzIGNvbW11bmVzIGV0cmUgYSBldCBiLCBzaSBvdWkgb24gZW5sw6h2ZSBsYSBwb3NzaWJpbHRpw6kgZGFucyBhLlxuICAgKiBAcGFyYW0gYVxuICAgKiBAcGFyYW0gYlxuICAgKiBAcmV0dXJucyBzaSB1bmUgdmFsZXVyIMOgIMOpdMOpIHN1cHByaW3DqWUuXG4gICAqL1xuICBwcml2YXRlIHJlbW92ZUluY29uc2lzdGVudFZhbHVlcyhhOiBzdHJpbmcsIGI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGxldCByZW1vdmVkID0gZmFsc2U7XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KGEpKSB7XG4gICAgICBsZXQgY29uZmxpY3QgPSBmYWxzZTtcbiAgICAgIGZvciAoY29uc3QgcG9zcyBvZiB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KGIpKSB7XG4gICAgICAgIGlmIChwb3NzICE9PSB2YWx1ZSkge1xuICAgICAgICAgIGNvbmZsaWN0ID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFjb25mbGljdCkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMucG9zc2liaWxpdGllcy5nZXQoYSkuaW5kZXhPZih2YWx1ZSk7XG4gICAgICAgIHRoaXMucG9zc2liaWxpdGllcy5nZXQoYSkuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgcmVtb3ZlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZW1vdmVkO1xuICB9XG5cbiAgLy8gTVJWIDogT24gY2hvaXNpdCBsYSBjZWxsdWxlICh2YXJpYWJsZSkgYXZlYyBsZSBtb2lucyBkZSBwb3NzaWJpbGl0w6kuXG4gIHByaXZhdGUgc2VsZWN0VW5hc3NpZ25lZFZhcmlhYmxlcyhhc3NpZ25lbWVudDogTWFwPHN0cmluZywgbnVtYmVyPik6IHN0cmluZyB7XG4gICAgY29uc3QgdW5hc3NpZ25lZCA9IHRoaXMudmFyaWFibGVzLmZpbHRlcihcbiAgICAgIHYgPT4gWy4uLmFzc2lnbmVtZW50LmtleXMoKV0uaW5kZXhPZih2KSA9PT0gLTFcbiAgICApO1xuICAgIGxldCBtaW4gPSAxMDtcbiAgICBsZXQgbWluViA9IHVuZGVmaW5lZDtcbiAgICBmb3IgKGNvbnN0IFt2YXJpYWJsZSwgcG9zc10gb2YgdGhpcy5wb3NzaWJpbGl0aWVzKSB7XG4gICAgICBpZiAodW5hc3NpZ25lZC5pbmRleE9mKHZhcmlhYmxlKSA9PT0gLTEpIGNvbnRpbnVlO1xuICAgICAgaWYgKHBvc3MubGVuZ3RoIDw9IG1pbikge1xuICAgICAgICBtaW4gPSBwb3NzLmxlbmd0aDtcbiAgICAgICAgbWluViA9IHZhcmlhYmxlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWluVjtcbiAgfVxuXG4gIC8qKlxuICAgKiBPbiBjYWxjdWwgbGVzIGNvbmZsaXRzIGV4aXN0YW50cyBhdmVjIGxlcyBjZWxsdWxlcyB2b2lzaW5lcy5cbiAgICogRXN0IHV0aWxpc8OpIGRhbnMgTENWLlxuICAgKiBAcGFyYW0gdmFyaWFibGVcbiAgICogQHBhcmFtIHZhbHVlXG4gICAqL1xuICBwcml2YXRlIGNvbmZsaWN0cyh2YXJpYWJsZTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBsZXQgbmJDb25mbGljdHMgPSAwO1xuICAgIGZvciAobGV0IG5laWdoYm9yIG9mIHRoaXMubmVpZ2hib3JzLmdldCh2YXJpYWJsZSkpIHtcbiAgICAgIC8vIFNpIGwnaW50ZXJzZWN0aW9uIGRlcyBkZXV4IHBvc3NpYmlsaXTDqXMgbidlc3QgcGFzIHZpZGVcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5wb3NzaWJpbGl0aWVzLmdldChuZWlnaGJvcikubGVuZ3RoID4gMSAmJlxuICAgICAgICB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KG5laWdoYm9yKS5pbmRleE9mKHZhbHVlKSAhPT0gLTFcbiAgICAgICkge1xuICAgICAgICBuYkNvbmZsaWN0cysrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmJDb25mbGljdHM7XG4gIH1cblxuICAvLyBMQ1YgOiBPbiBjaG9pc2l0IHVuZSB2YWxldXIgcXVpIMOgIGxlIG1vaW5zIGQnaW1wYWN0IHN1ciBsZXMgdmFyaWFibGVzIHZvaXNpbmVzXG4gIHByaXZhdGUgb3JkZXJEb21haW5zVmFsdWVzKHZhcmlhYmxlOiBzdHJpbmcpOiBudW1iZXJbXSB7XG4gICAgbGV0IHBvc3MgPSB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KHZhcmlhYmxlKTtcbiAgICByZXR1cm4gcG9zcy5zb3J0KChhOiBudW1iZXIsIGI6IG51bWJlcik6IG51bWJlciA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5jb25mbGljdHModmFyaWFibGUsIGEpIC0gdGhpcy5jb25mbGljdHModmFyaWFibGUsIGIpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE9uIHMnYXNzdXJlIHF1ZSBsYSB2YXJpYWJsZSBuJ2VzdCBwYXMgaW5jb25zaXN0ZW50ZSBhdmVjIGxlcyBhc3NpZ25lbWVudHNcbiAgICogQHBhcmFtIGFzc2lnbmVtZW50XG4gICAqIEBwYXJhbSB2YXJpYWJsZVxuICAgKiBAcGFyYW0gdmFsdWVcbiAgICovXG4gIHByaXZhdGUgaXNDb25zaXN0ZW50KFxuICAgIGFzc2lnbmVtZW50OiBNYXA8c3RyaW5nLCBudW1iZXI+LFxuICAgIHZhcmlhYmxlOiBzdHJpbmcsXG4gICAgdmFsdWU6IG51bWJlclxuICApOiBib29sZWFuIHtcbiAgICBmb3IgKGNvbnN0IFtfdmFyaWFibGUsIF92YWx1ZV0gb2YgYXNzaWduZW1lbnQpIHtcbiAgICAgIC8vIHNpIGRldXggdmFyaWFibGVzIG9udCBsYSBtw6ptZSB2YWxldXIgZXQgcXUnZWxsZXMgc29udCB2b2lzaW5lcyBhbG9ycyBpbmNvbnNpc3RlbnQuXG4gICAgICBpZiAoXG4gICAgICAgIF92YWx1ZSA9PT0gdmFsdWUgJiZcbiAgICAgICAgdGhpcy5uZWlnaGJvcnMuZ2V0KHZhcmlhYmxlKS5pbmRleE9mKF92YXJpYWJsZSkgIT09IC0xXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHByaXZhdGUgYXNzaWduKFxuICAgIGFzc2lnbmVtZW50OiBNYXA8c3RyaW5nLCBudW1iZXI+LFxuICAgIHZhcmlhYmxlOiBzdHJpbmcsXG4gICAgdmFsdWU6IG51bWJlclxuICApIHtcbiAgICBhc3NpZ25lbWVudC5zZXQodmFyaWFibGUsIHZhbHVlKTtcblxuICAgIHRoaXMuZm9yd2FyZENoZWNrKGFzc2lnbmVtZW50LCB2YXJpYWJsZSwgdmFsdWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIE9uIGVubMOodmUgZGFucyBsYSBsaXN0ZSBkZXMgcG9zc2liaWxpdMOpcyBkZXMgY2VsbHVsZXMgdm9pc2luZXMgbGEgdmFsZXVyIHF1J29uIHZpZW50IGQnYXR0cmlidWVyIMOgIGxhIHZhcmlhYmxlXG4gICAqIEBwYXJhbSBhc3NpZ25lbWVudFxuICAgKiBAcGFyYW0gdmFyaWFibGVcbiAgICogQHBhcmFtIHZhbHVlXG4gICAqL1xuICBwcml2YXRlIGZvcndhcmRDaGVjayhcbiAgICBhc3NpZ25lbWVudDogTWFwPHN0cmluZywgbnVtYmVyPixcbiAgICB2YXJpYWJsZTogc3RyaW5nLFxuICAgIHZhbHVlOiBudW1iZXJcbiAgKSB7XG4gICAgZm9yIChjb25zdCBuZWlnaGJvciBvZiB0aGlzLm5laWdoYm9ycy5nZXQodmFyaWFibGUpKSB7XG4gICAgICBpZiAoWy4uLmFzc2lnbmVtZW50LmtleXMoKV0uaW5kZXhPZihuZWlnaGJvcikgPT09IC0xKSB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5wb3NzaWJpbGl0aWVzLmdldChuZWlnaGJvcikuaW5kZXhPZih2YWx1ZSk7XG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICB0aGlzLnBvc3NpYmlsaXRpZXMuZ2V0KG5laWdoYm9yKS5zbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZShhc3NpZ25lbWVudDogTWFwPHN0cmluZywgbnVtYmVyPiwgdmFyaWFibGU6IHN0cmluZykge1xuICAgIGFzc2lnbmVtZW50LmRlbGV0ZSh2YXJpYWJsZSk7XG4gIH1cblxuICAvKipcbiAgICogUHNldWRvIGNvZGUgOiBodHRwczovL3d3dy5jcHAuZWR1L35mdGFuZy9jb3Vyc2VzL0NTNDIwL25vdGVzL0NTUC5wZGZcbiAgICogQHBhcmFtIGFzc2lnbmVtZW50XG4gICAqL1xuICBwcml2YXRlIGJhY2t0cmFja2luZyhhc3NpZ25lbWVudDogTWFwPHN0cmluZywgbnVtYmVyPikge1xuICAgIGlmIChhc3NpZ25lbWVudC5zaXplID09PSB0aGlzLnZhcmlhYmxlcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBhc3NpZ25lbWVudDtcbiAgICB9XG4gICAgY29uc3QgdmFyaWFibGUgPSB0aGlzLnNlbGVjdFVuYXNzaWduZWRWYXJpYWJsZXMoYXNzaWduZW1lbnQpO1xuXG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0aGlzLm9yZGVyRG9tYWluc1ZhbHVlcyh2YXJpYWJsZSkpIHtcbiAgICAgIGlmICh0aGlzLmlzQ29uc2lzdGVudChhc3NpZ25lbWVudCwgdmFyaWFibGUsIHZhbHVlKSkge1xuICAgICAgICB0aGlzLmFzc2lnbihhc3NpZ25lbWVudCwgdmFyaWFibGUsIHZhbHVlKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmJhY2t0cmFja2luZyhhc3NpZ25lbWVudCk7XG5cbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW1vdmUoYXNzaWduZW1lbnQsIHZhcmlhYmxlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBjbGVhclBvc3NpYmlsaXRpZXMocG9zc2liaWxpdGVzOiBNYXA8c3RyaW5nLCBudW1iZXJbXT4pIHtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBwb3NzaWJpbGl0ZXMua2V5cygpKSB7XG4gICAgICBwb3NzaWJpbGl0ZXMuc2V0KGtleSwgWzBdKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgcHJvY2VzcygpOiBbYm9vbGVhbiwgTWFwPHN0cmluZywgbnVtYmVyW10+XSB7XG4gICAgaWYgKHRoaXMuYWMzKCkpIHtcbiAgICAgIC8vIG9uIHbDqXJpZmllIHNpIGxlIHN1ZG9rdSBlc3QgY29tcGxldFxuICAgICAgY29uc3QgaXNGaW5pc2hlZCA9XG4gICAgICAgIFsuLi50aGlzLnBvc3NpYmlsaXRpZXMudmFsdWVzKCldLmZpbHRlcih2ID0+IHYubGVuZ3RoICE9PSAxKS5sZW5ndGggPT09XG4gICAgICAgIDA7XG4gICAgICBpZiAoIWlzRmluaXNoZWQpIHtcbiAgICAgICAgbGV0IGFzc2lnbmVtZW50ID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICAgICAgZm9yIChjb25zdCB2IG9mIHRoaXMudmFyaWFibGVzKSB7XG4gICAgICAgICAgaWYgKHRoaXMucG9zc2liaWxpdGllcy5nZXQodikubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICBhc3NpZ25lbWVudC5zZXQodiwgdGhpcy5wb3NzaWJpbGl0aWVzLmdldCh2KVswXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGFzc2lnbmVtZW50ID0gdGhpcy5iYWNrdHJhY2tpbmcoYXNzaWduZW1lbnQpO1xuXG4gICAgICAgICAgaWYgKCFhc3NpZ25lbWVudCkge1xuICAgICAgICAgICAgdGhpcy5jbGVhclBvc3NpYmlsaXRpZXModGhpcy5wb3NzaWJpbGl0aWVzKTtcbiAgICAgICAgICAgIHJldHVybiBbZmFsc2UsIHRoaXMucG9zc2liaWxpdGllc107XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZm9yIChjb25zdCBbdmFyaWFibGUsIHZhbHVlXSBvZiBhc3NpZ25lbWVudCkge1xuICAgICAgICAgICAgdGhpcy5wb3NzaWJpbGl0aWVzLnNldCh2YXJpYWJsZSwgW3ZhbHVlXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gW3RydWUsIHRoaXMucG9zc2liaWxpdGllc107XG4gICAgfVxuICAgIHRoaXMuY2xlYXJQb3NzaWJpbGl0aWVzKHRoaXMucG9zc2liaWxpdGllcyk7XG4gICAgcmV0dXJuIFtmYWxzZSwgdGhpcy5wb3NzaWJpbGl0aWVzXTtcbiAgfVxufVxuXG4vLyBVVElMSVRZIEZVTkNUSU9OU1xuXG5jb25zdCBjcm9zcyA9IChBOiBzdHJpbmcsIEI6IHN0cmluZyk6IEFycmF5PHN0cmluZz4gPT4ge1xuICBsZXQgcmVzID0gbmV3IEFycmF5PHN0cmluZz4oKTtcbiAgZm9yIChsZXQgX2Egb2YgQSkge1xuICAgIGZvciAobGV0IF9iIG9mIEIpIHtcbiAgICAgIHJlcy5wdXNoKF9hICsgXCJcIiArIF9iKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlcztcbn07XG4iXX0=